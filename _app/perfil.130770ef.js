import P from"./Icon.5866ecc8.js";import{_ as C}from"./ProgressDialog.a82c5eb3.js";import{f as l,m as e,p as a,u as o,F as V,y as T,w as j,q as c,K as h,x as f,A as i,D as _,t,s as b,k as g,N as v,C as u,l as w,j as y,o as d,O as m,Q as I}from"./entry.c9d07ec2.js";import"./config.d21ad8df.js";const N={class:"bg-body-tertiary border rounded p-2 mb-2 shadow"},$={class:"text-primary-emphasis m-0"},q={class:"m-2"},B=["value"],D={class:"bg-body-tertiary border rounded p-2 mb-2 shadow"},G={class:"text-primary-emphasis m-0"},M={class:"m-2"},O=["value"],F={class:"bg-body-tertiary border rounded p-2 mb-2 shadow"},K={class:"text-primary-emphasis m-0"},S={class:"m-2"},z={key:1,class:"m-0"},E={key:0,class:"bg-body-tertiary border rounded p-2 mb-2 shadow"},L={class:"text-primary-emphasis m-0"},Q={class:"m-2"},R={class:"mb-3 position-relative form-floating"},U=["placeholder","value"],H={class:"invalid-tooltip"},J={class:"mb-3 form-floating"},W=["placeholder","value"],X={class:"mb-3 form-floating"},Y=["placeholder","value"],Z={class:"d-grid"},x={class:"btn btn-primary",type:"submit",role:"button"},ss={key:1,class:"bg-body-tertiary border rounded p-2 shadow"},es={class:"text-primary-emphasis m-0"},os={class:"m-2"},ts=["value"],rs={key:2,class:"d-grid"},as={key:3,class:"text-center mt-3"},ns={class:"small m-0"},is={data(){return{dialog:"",readonly:{nombre:i().user.nombre,email:i().user.email,token:i().user.token,tarjetas:[]},form:{current_password:"",new_password:"",password_check:"",error:!1}}},computed:{isPasswordValid(){return this.form.new_password.length>=3&&this.form.current_password!==this.form.new_password&&this.form.current_password.length>0},isPasswordCheckValid(){return this.isPasswordValid&&this.form.new_password===this.form.password_check}},async mounted(){this.readonly.tarjetas=await _.getTarjetas()},methods:{async updatePass(){if(this.isPasswordValid&&this.isPasswordCheckValid){this.dialog=t("updating_pass"),b("progress-dialog");const{error:p,error_key:s}=await g.userPassUpdate({current_password:await v(this.form.current_password),new_password:await v(this.form.new_password),email:i().user.email,token:i().user.token});p?(s==="pass_error"&&(this.form.error=!0,this.$refs.current.focus()),await u.showToast(t(s),"long")):(await u.showToast(t("pass_updated"),"long"),this.form={current_password:"",new_password:"",password_check:""})}await w(.5),y("progress-dialog")},copyToken(p){p.target.select(),u.writeToClipboard(this.readonly.token)},async deleteAccount(){if(await u.confirm(t("delete_account"),t("delete_account_sure"))){this.dialog=t("deleting_account"),b("progress-dialog");const{error:s,error_key:r}=await g.deleteAccount({email:i().user.email,token:i().user.token});s?(await u.showToast(t(r)),await w(.5),y("progress-dialog")):(await _.deleteAll(),await i().logout(),await u.showToast(t("account_deleted")),await w(.5),y("progress-dialog"),this.$router.replace("/"))}}}},ms=Object.assign(is,{__name:"perfil",setup(p){return(s,r)=>{const k=P,A=C;return d(),l("section",null,[e("div",N,[e("h4",$,[e("b",null,a(("t"in s?s.t:o(t))("nombre")),1)]),e("div",q,[e("input",{value:("readonly"in s?s.readonly:o(m)).nombre,class:"form-control py-2",type:"text",readonly:""},null,8,B)])]),e("div",D,[e("h4",G,[e("b",null,a(("t"in s?s.t:o(t))("correo")),1)]),e("div",M,[e("input",{value:("readonly"in s?s.readonly:o(m)).email,class:"form-control py-2",type:"text",readonly:""},null,8,O)])]),e("div",F,[e("h4",K,[e("b",null,a(("t"in s?s.t:o(t))("tarjetas_vinculadas")),1)]),e("div",S,[("readonly"in s?s.readonly:o(m)).tarjetas.length?(d(!0),l(V,{key:0},T(("readonly"in s?s.readonly:o(m)).tarjetas,n=>(d(),l("p",{key:n.numero,class:"m-0"},[f(k,{name:"material-symbols:credit-card-outline"}),I(" "+a(n.numero)+" ("+a(n.nombre)+")",1)]))),128)):(d(),l("p",z,a(("t"in s?s.t:o(t))("no_tarjetas")),1))])]),("Auth"in s?s.Auth:o(i))().isGuest?h("",!0):(d(),l("div",E,[e("h4",L,[e("b",null,a(("t"in s?s.t:o(t))("password")),1)]),e("div",Q,[e("form",{novalidate:"",onSubmit:r[4]||(r[4]=j(n=>s.updatePass(),["prevent"]))},[e("div",R,[e("input",{ref:"current",class:c(["form-control",{"is-invalid":s.form.error}]),type:"password",autocomplete:"password",placeholder:("t"in s?s.t:o(t))("current_pass"),value:s.form.current_password,required:"",onInput:r[0]||(r[0]=n=>s.form.current_password=n.target.value),onKeyup:r[1]||(r[1]=n=>s.form.error=!1)},null,42,U),e("label",null,a(("t"in s?s.t:o(t))("current_pass")),1),e("div",H,a(("t"in s?s.t:o(t))("pass_error")),1)]),e("div",J,[e("input",{class:c(["form-control",{"is-valid":s.isPasswordValid}]),type:"password",autocomplete:"new-password",placeholder:("t"in s?s.t:o(t))("new_pass"),value:s.form.new_password,required:"",onInput:r[2]||(r[2]=n=>s.form.new_password=n.target.value)},null,42,W),e("label",null,a(("t"in s?s.t:o(t))("new_pass")),1)]),e("div",X,[e("input",{class:c(["form-control",{"is-valid":s.isPasswordCheckValid}]),type:"password",autocomplete:"off",placeholder:("t"in s?s.t:o(t))("password_check"),value:s.form.password_check,required:"",onInput:r[3]||(r[3]=n=>s.form.password_check=n.target.value)},null,42,Y),e("label",null,a(("t"in s?s.t:o(t))("password_check")),1)]),e("div",Z,[e("button",x,a(("t"in s?s.t:o(t))("change_pass")),1)])],32)])])),("Auth"in s?s.Auth:o(i))().isGuest?h("",!0):(d(),l("div",ss,[e("h4",es,[e("b",null,a(("t"in s?s.t:o(t))("account_id")),1)]),e("div",os,[e("input",{value:("readonly"in s?s.readonly:o(m)).token,class:"form-control py-2",type:"text",readonly:"",onClick:r[5]||(r[5]=n=>s.copyToken(n))},null,8,ts)])])),("Auth"in s?s.Auth:o(i))().isGuest?h("",!0):(d(),l("div",rs,[e("button",{class:"btn btn-danger mt-2",onClick:r[6]||(r[6]=n=>s.deleteAccount())},a(("t"in s?s.t:o(t))("delete_account")),1)])),("Auth"in s?s.Auth:o(i))().isGuest?(d(),l("div",as,[e("p",ns,[e("small",null,a(("t"in s?s.t:o(t))("nota")),1)])])):h("",!0),f(A,{message:s.dialog},null,8,["message"])])}}});export{ms as default};
