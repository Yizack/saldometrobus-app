import E from"./DBOd63DP.js";import{_ as F}from"./RPdvtKHW.js";import{_ as O}from"./pBGypGOw.js";import{e as R,A as K,B as y,q as G,O as L,P as U,c as m,b as w,I as g,E as k,w as _,f as t,a,t as d,o as u,i as h,v as T,z as C,T as Q,g as s,M as H,N as J,h as W,Q as P,C as p,s as q,k as B,l as N,n as X}from"#entry";import{u as Y}from"./BTPz0zLs.js";const Z={class:"input-group"},x=["value"],ee={class:"ms-2 my-0"},te={key:1,class:"m-0"},se=["value"],oe={class:"mb-3 position-relative form-floating"},ae=["placeholder"],ne={class:"invalid-tooltip"},re={class:"mb-3 form-floating"},le=["placeholder"],ie={class:"mb-3 form-floating"},ue=["placeholder"],de={class:"d-grid"},pe={class:"btn btn-primary",type:"submit",role:"button"},me=["value"],ce={key:2,class:"d-grid"},we={key:3,class:"text-center mt-3"},_e={class:"small m-0"},he=R({__name:"perfil",setup(ve){const n=K(),A=y(""),v=y({nombre:!1}),l=y({nombre:n.user.nombre,email:n.user.email,token:n.user.token,tarjetas:[]}),r=Y({current_password:"",new_password:"",password_check:"",error:!1}),V=G(()=>r.value.new_password.length>=3&&r.value.current_password!==r.value.new_password&&r.value.current_password.length>0),M=G(()=>V.value&&r.value.new_password===r.value.password_check),c=y(),D=async()=>{if(v.value.nombre=!v.value.nombre,l.value.nombre=l.value.nombre.trim(),v.value.nombre){const e=l.value.nombre.length;c.value?.setSelectionRange(e,e),c.value?.focus(),c.value?.removeAttribute("readonly")}else{if(l.value.nombre!==n.user.nombre){const{error:e,error_key:o}=await P.updateName({nombre:l.value.nombre,email:n.user.email,token:n.user.token||""});e?(l.value.nombre=n.user.nombre,await p.showToast(s(o))):(n.updateName(l.value.nombre),await p.showToast(s("name_updated")))}c.value?.setAttribute("readonly","true"),c.value?.blur()}},j=y(),I=async()=>{if(V.value&&M.value){A.value=s("updating_pass"),q("progress-dialog");const{error:e,error_key:o}=await P.userPassUpdate({current_password:r.value.current_password,new_password:r.value.new_password,email:n.user.email,token:n.user.token});e?(o==="pass_error"&&(r.value.error=!0,j.value?.focus()),await p.showToast(s(o),"long")):(await p.showToast(s("pass_updated"),"long"),r.reset())}await B(.5),N("progress-dialog")},S=e=>{e.currentTarget.select(),p.writeToClipboard(l.value.token)},$=async()=>{if(await p.confirm(s("delete_account"),s("delete_account_sure"))){A.value=s("deleting_account"),q("progress-dialog");const{error:o,error_key:f}=await P.deleteAccount({email:n.user.email,token:n.user.token});o?(await p.showToast(s(f)),await B(.5),N("progress-dialog")):(await U.deleteAll(),await n.logout(),await p.showToast(s("account_deleted")),await B(.5),N("progress-dialog"),X("/",{replace:!0}))}};return L(async()=>{l.value.tarjetas=await U.getTarjetas()}),(e,o)=>{const f=E,b=F,z=O;return u(),m("section",null,[w(b,{title:("t"in e?e.t:t(s))("perfil")},{default:_(()=>[a("div",Z,[h(a("input",{ref_key:"nombre",ref:c,"onUpdate:modelValue":o[0]||(o[0]=i=>t(l).nombre=i),class:"form-control py-2",type:"text",readonly:""},null,512),[[T,t(l).nombre]]),t(n).isGuest?k("",!0):(u(),m("button",{key:0,class:C(["btn btn-sm",t(v).nombre?"btn-success":"btn-secondary"]),style:{width:"3rem"},onClick:o[1]||(o[1]=i=>D())},[w(Q,{name:"tab",mode:"out-in"},{default:_(()=>[t(v).nombre?(u(),g(f,{key:0,name:"check"})):(u(),g(f,{key:1,name:"edit"}))]),_:1})],2))])]),_:1},8,["title"]),w(b,{title:("t"in e?e.t:t(s))("correo")},{default:_(()=>[a("input",{value:t(l).email,class:"form-control py-2",type:"text",readonly:""},null,8,x)]),_:1},8,["title"]),w(b,{title:("t"in e?e.t:t(s))("tarjetas_vinculadas")},{default:_(()=>[t(l).tarjetas.length?(u(!0),m(H,{key:0},J(t(l).tarjetas,i=>(u(),m("div",{key:i.numero,class:"d-flex align-items-center"},[w(f,{name:"card"}),a("p",ee,d(i.numero)+" ("+d(i.nombre)+")",1)]))),128)):(u(),m("p",te,d(("t"in e?e.t:t(s))("no_tarjetas")),1))]),_:1},8,["title"]),t(n).isGuest?k("",!0):(u(),g(b,{key:0,title:("t"in e?e.t:t(s))("password")},{default:_(()=>[a("form",{novalidate:"",onSubmit:W(I,["prevent"])},[a("input",{type:"text",class:"d-none",name:"email",value:t(n).user.email,autocomplete:"email"},null,8,se),a("div",oe,[h(a("input",{ref_key:"current",ref:j,"onUpdate:modelValue":o[2]||(o[2]=i=>t(r).current_password=i),class:C(["form-control",{"is-invalid":t(r).error}]),type:"password",autocomplete:"password",placeholder:("t"in e?e.t:t(s))("current_pass"),required:"",onKeyup:o[3]||(o[3]=i=>t(r).error=!1)},null,42,ae),[[T,t(r).current_password]]),a("label",null,d(("t"in e?e.t:t(s))("current_pass")),1),a("div",ne,d(("t"in e?e.t:t(s))("pass_error")),1)]),a("div",re,[h(a("input",{"onUpdate:modelValue":o[4]||(o[4]=i=>t(r).new_password=i),class:C(["form-control",{"is-valid":t(V)}]),type:"password",autocomplete:"new-password",placeholder:("t"in e?e.t:t(s))("new_pass"),required:""},null,10,le),[[T,t(r).new_password]]),a("label",null,d(("t"in e?e.t:t(s))("new_pass")),1)]),a("div",ie,[h(a("input",{"onUpdate:modelValue":o[5]||(o[5]=i=>t(r).password_check=i),class:C(["form-control",{"is-valid":t(M)}]),type:"password",autocomplete:"off",placeholder:("t"in e?e.t:t(s))("password_check"),required:""},null,10,ue),[[T,t(r).password_check]]),a("label",null,d(("t"in e?e.t:t(s))("password_check")),1)]),a("div",de,[a("button",pe,d(("t"in e?e.t:t(s))("change_pass")),1)])],32)]),_:1},8,["title"])),t(n).isGuest?k("",!0):(u(),g(b,{key:1,title:("t"in e?e.t:t(s))("account_id")},{default:_(()=>[a("input",{value:t(l).token,class:"form-control py-2",type:"text",readonly:"",onClick:o[6]||(o[6]=i=>S(i))},null,8,me)]),_:1},8,["title"])),t(n).isGuest?k("",!0):(u(),m("div",ce,[a("button",{class:"btn btn-danger mt-2",onClick:$},d(("t"in e?e.t:t(s))("delete_account")),1)])),t(n).isGuest?(u(),m("div",we,[a("p",_e,[a("small",null,d(("t"in e?e.t:t(s))("nota")),1)])])):k("",!0),w(z,{message:t(A)},null,8,["message"])])}}});export{he as default};
