import{_ as L}from"./Icon.d87c2e59.js";import{_ as A}from"./ProgressDialog.94cc4709.js";import{_ as z,o as p,c as u,a as s,t as a,j as i,f as e,b as v,w as C,K as D,H as M,l as P,m as $,v as k,A as h,D as l,i as w,s as y,g as j,C as c,h as T,F,r as I}from"./entry.7810faf7.js";import"./nuxt-icon.vue.d549cb03.js";const U={},V={id:"limit-dialog",class:"modal fade",tabindex:"-1","aria-labelledby":"progress-dialog-label","aria-hidden":"true","data-bs-backdrop":"static"},B={class:"modal-dialog modal-dialog-centered"},S={class:"modal-content"},E={class:"modal-header"},R={id:"progress-dialog-label",class:"modal-title text-primary-emphasis"},G={class:"modal-body"},N={class:"m-0"},O={class:"modal-footer"},q={class:"btn btn-primary w-100",type:"button","data-bs-dismiss":"modal"};function H(n,t){return p(),u("div",V,[s("div",B,[s("div",S,[s("div",E,[s("h5",R,a(("t"in n?n.t:i(e))("limit_tittle")),1)]),s("div",G,[s("p",N,a(("t"in n?n.t:i(e))("limit_message")),1)]),s("div",O,[s("button",q,a(("t"in n?n.t:i(e))("entendido")),1)])])])])}const K=z(U,[["render",H]]),Z=""+globalThis.__publicAssetsURL("images/rapipass.webp"),J=""+globalThis.__publicAssetsURL("images/metro_metrobus.webp"),Q=""+globalThis.__publicAssetsURL("images/metrobus.webp"),W=["onClick"],X={class:"flex-grow-1"},Y={class:"text-primary-emphasis m-0"},x={class:"info mx-2 small"},tt={class:"m-0"},st={class:"m-0"},et={class:"m-0"},at={class:"m-0"},ot={class:"text-nowrap"},it={class:"actions d-flex flex-column"},nt={class:"image mb-2 mt-2"},rt=["width","height"],dt=["width","height"],lt=["width","height"],mt={class:"d-grid"},ht=["onClick"],ct={key:0,class:"text-center mt-3"},pt={class:"small m-0"},ut={class:"position-fixed bottom-0 end-0 m-3"},_t={class:"btn btn-primary rounded-circle p-1 shadow",role:"button","data-bs-toggle":"modal","data-bs-target":"#add-dialog"},gt={id:"add-dialog",class:"modal fade",tabindex:"-1","aria-labelledby":"add-dialog-label","aria-hidden":"true","data-bs-backdrop":"static"},bt={class:"modal-dialog modal-dialog-centered"},ft={class:"modal-content"},wt={class:"modal-header"},vt={id:"add-dialog-label",class:"modal-title fs-5 text-primary-emphasis"},jt={class:"modal-body text-center"},yt={class:"mb-3 position-relative form-floating"},Tt=["placeholder"],$t={class:"invalid-tooltip"},kt={class:"mb-3 position-relative form-floating"},Lt=["placeholder"],At={class:"invalid-tooltip"},zt={class:"d-flex justify-content-end"},Ct={class:"btn btn-danger me-2",type:"button","data-bs-dismiss":"modal"},Dt={class:"btn btn-primary",type:"submit",role:"button"},Mt={name:"AppPage",data(){return{tarjetas:[],size:100,fetched:0,fetchLimit:4,form:{numero:"",nombre:""},progress:""}},computed:{isFetchLimited(){return this.fetched>this.fetchLimit}},async mounted(){if(h().exists&&(this.tarjetas=await l.getTarjetas(),!h().user.updated&&!this.tarjetas.length&&!h().isGuest)){this.progress=e("adding_tarjetas"),await w(.5),y("progress-dialog");const{email:n,token:t}=h().user,{error:d,error_key:r,tarjetas:m}=await j.getTarjetas({email:n,token:t})||[];let _=[];d&&await c.showToast(e(r),"long"),m&&(this.fetched=m.length,this.isFetchLimited?_=m||[]:_=await j.getDetallesTarjetas({email:n,token:t})||[]);for(const b of _){const{changes:f}=await l.insertTarjeta(b);f>0&&!this.isFetchLimited&&await l.insertMovimientos(b)}const o=await l.getTarjetas(),g=o.entries();for(const[b,f]of g){if(this.tarjetas.push(f),await c.showToast(`${e("tarjeta_added")}: ${f.numero}`),o.length-1===b)break;await w(.5)}await h().setUpdated(),await w(.5),T("progress-dialog"),this.isFetchLimited&&(await w(.5),y("limit-dialog"))}},methods:{async addTarjeta(){this.progress=e("adding_tarjeta");const n=this.$refs.add;if(n.checkValidity()){T("add-dialog"),y("progress-dialog");const{nombre:t,numero:d}=this.form,{tarjeta:r,error:m,error_key:_}=await j.getTarjetaAPI(d);if(r&&!m){if(r.nombre=String(t).trim(),r.fecha_added=new Date().toISOString().replace("T"," ").replace("Z",""),await l.tarjetaExists(r.numero))await c.showToast(`${e("existe_tarjeta")}: ${r.numero}`);else{const{error:g,error_key:b}=h().isGuest?{error:!1}:await j.addTarjeta({nombre:r.nombre,numero:r.numero,email:h().user.email,token:h().user.token}),{changes:f}=await l.insertTarjeta(r);f>0&&!g?(await l.insertMovimientos(r),await c.showToast(`${e("tarjeta_added")}: ${r.numero}`)):await c.showToast(e(b)),this.tarjetas=await l.getTarjetas()}this.form={numero:"",nombre:""}}else await c.showToast(e(_),"long");await w(.5),T("progress-dialog"),n.classList.remove("was-validated")}else n.classList.add("was-validated")},openCard(n){this.$router.push(`${n}`)},async updateTarjeta(n){this.progress=e("actualizando_tarjeta"),y("progress-dialog");const{tarjeta:t,error:d,error_key:r}=await j.getTarjetaAPI(n);if(t&&!d){const{changes:m}=await l.updateTarjeta(t);m>0&&(await l.deleteMovimientos(n),await l.insertMovimientos(t),await c.showToast(`${e("tarjeta_actualizada")}: ${t.numero}`),this.tarjetas=await l.getTarjetas())}else await c.showToast(e(r),"long");await w(.5),T("progress-dialog")}}},Vt=Object.assign(Mt,{setup(n){return(t,d)=>{const r=L,m=A,_=K;return p(),u("section",null,[v(D,{name:"tab"},{default:C(()=>[(p(!0),u(F,null,I(t.tarjetas,o=>(p(),u("div",{key:o.numero,class:"bg-body-tertiary border rounded d-flex p-2 mb-2 shadow",role:"button",onClick:g=>t.openCard(o.numero)},[s("div",X,[s("h4",Y,[s("b",null,a(o.nombre),1)]),s("div",x,[s("p",tt,a(("t"in t?t.t:i(e))("numero"))+": "+a(o.numero),1),s("p",st,a(("t"in t?t.t:i(e))("estado"))+": "+a(o.estado),1),s("p",et,a(("t"in t?t.t:i(e))("tipo"))+": "+a(o.tipo),1),s("p",at,a(("t"in t?t.t:i(e))("fecha"))+": "+a(o.fecha),1),s("h3",ot,[s("b",null,a(("t"in t?t.t:i(e))("saldo"))+": B/. "+a(o.saldo),1)])])]),s("div",it,[s("div",nt,[o.tipo===("t"in t?t.t:i(e))("tarjeta_rapipass")?(p(),u("img",{key:0,class:"img-fluid",src:Z,width:t.size,height:t.size},null,8,rt)):o.tipo===("t"in t?t.t:i(e))("tarjeta_normal")?(p(),u("img",{key:1,class:"img-fluid",src:J,width:t.size,height:t.size},null,8,dt)):(p(),u("img",{key:2,src:Q,class:"img-fluid",width:t.size,height:t.size},null,8,lt))]),s("div",mt,[s("button",{class:"btn btn-primary btn-sm",role:"button",onClick:g=>{g.stopPropagation(),t.updateTarjeta(o.numero)}},[v(r,{name:"refresh",size:"md"})],8,ht)])])],8,W))),128))]),_:1}),t.tarjetas.length?(p(),u("div",ct,[s("p",pt,[s("small",null,a(("t"in t?t.t:i(e))("tarjetas_note")),1)])])):M("",!0),s("div",ut,[s("button",_t,[v(r,{name:"plus",size:"lg"})])]),s("div",gt,[s("div",bt,[s("div",ft,[s("div",wt,[s("h1",vt,a(("t"in t?t.t:i(e))("add_tarjeta")),1)]),s("div",jt,[s("form",{ref:"add",novalidate:"",onSubmit:d[2]||(d[2]=P(o=>t.addTarjeta(),["prevent"]))},[s("div",yt,[$(s("input",{"onUpdate:modelValue":d[0]||(d[0]=o=>t.form.nombre=o),class:"form-control",type:"text",placeholder:("t"in t?t.t:i(e))("nombre"),required:""},null,8,Tt),[[k,t.form.nombre]]),s("label",null,a(("t"in t?t.t:i(e))("nombre")),1),s("div",$t,a(("t"in t?t.t:i(e))("obligatorio")),1)]),s("div",kt,[$(s("input",{"onUpdate:modelValue":d[1]||(d[1]=o=>t.form.numero=o),class:"form-control",type:"number",pattern:"[0-9]",placeholder:("t"in t?t.t:i(e))("numero_tarjeta"),required:""},null,8,Lt),[[k,t.form.numero]]),s("label",null,a(("t"in t?t.t:i(e))("numero_tarjeta")),1),s("div",At,a(("t"in t?t.t:i(e))("error_tarjeta")),1)]),s("div",zt,[s("button",Ct,a(("t"in t?t.t:i(e))("cancel")),1),s("button",Dt,a(("t"in t?t.t:i(e))("add")),1)])],544)])])])]),v(m,{message:t.progress},null,8,["message"]),v(_)])}}});export{Vt as default};
