import P from"./Icon.9d460efd.js";import{_ as T}from"./ProgressDialog.b401d130.js";import{f as u,m as e,p as i,u as r,r as C,v as V,q as p,c as y,F as N,y as j,w as $,K as h,x as _,A as n,D as g,k as w,C as m,t as o,s as v,N as k,l as b,j as f,o as d,O as I}from"./entry.171743bc.js";import"./config.8b331bf2.js";const B={class:"bg-body-tertiary border rounded p-2 mb-2 shadow"},D={class:"text-primary-emphasis m-0"},q={class:"input-group p-2"},G={class:"bg-body-tertiary border rounded p-2 mb-2 shadow"},M={class:"text-primary-emphasis m-0"},O={class:"m-2"},F=["value"],K={class:"bg-body-tertiary border rounded p-2 mb-2 shadow"},S={class:"text-primary-emphasis m-0"},U={class:"m-2"},z={key:1,class:"m-0"},E={key:0,class:"bg-body-tertiary border rounded p-2 mb-2 shadow"},L={class:"text-primary-emphasis m-0"},R={class:"m-2"},H={class:"mb-3 position-relative form-floating"},J=["placeholder","value"],Q={class:"invalid-tooltip"},W={class:"mb-3 form-floating"},X=["placeholder","value"],Y={class:"mb-3 form-floating"},Z=["placeholder","value"],x={class:"d-grid"},ss={class:"btn btn-primary",type:"submit",role:"button"},es={key:1,class:"bg-body-tertiary border rounded p-2 shadow"},os={class:"text-primary-emphasis m-0"},ts={class:"m-2"},rs=["value"],as={key:2,class:"d-grid"},ns={key:3,class:"text-center mt-3"},is={class:"small m-0"},ls={data(){return{dialog:"",edit:{nombre:!1},user:{nombre:n().user.nombre,email:n().user.email,token:n().user.token,tarjetas:[]},form:{current_password:"",new_password:"",password_check:"",error:!1}}},computed:{isPasswordValid(){return this.form.new_password.length>=3&&this.form.current_password!==this.form.new_password&&this.form.current_password.length>0},isPasswordCheckValid(){return this.isPasswordValid&&this.form.new_password===this.form.password_check}},async mounted(){this.user.tarjetas=await g.getTarjetas()},methods:{async editName(){this.edit.nombre=!this.edit.nombre;const l=this.$refs.nombre;if(this.edit.nombre)l.focus(),l.removeAttribute("readonly");else{if(this.user.nombre!==n().user.nombre){const{error:s,error_key:t}=await w.updateName({nombre:this.user.nombre,email:n().user.email,token:n().user.token});s?(this.user.nombre=n().user.nombre,await m.showToast(o(t))):(n().updateName(this.user.nombre),await m.showToast(o("name_updated")))}l.setAttribute("readonly",!0),l.blur()}},async updatePass(){if(this.isPasswordValid&&this.isPasswordCheckValid){this.dialog=o("updating_pass"),v("progress-dialog");const{error:l,error_key:s}=await w.userPassUpdate({current_password:await k(this.form.current_password),new_password:await k(this.form.new_password),email:n().user.email,token:n().user.token});l?(s==="pass_error"&&(this.form.error=!0,this.$refs.current.focus()),await m.showToast(o(s),"long")):(await m.showToast(o("pass_updated"),"long"),this.form={current_password:"",new_password:"",password_check:""})}await b(.5),f("progress-dialog")},copyToken(l){l.target.select(),m.writeToClipboard(this.user.token)},async deleteAccount(){if(await m.confirm(o("delete_account"),o("delete_account_sure"))){this.dialog=o("deleting_account"),v("progress-dialog");const{error:s,error_key:t}=await w.deleteAccount({email:n().user.email,token:n().user.token});s?(await m.showToast(o(t)),await b(.5),f("progress-dialog")):(await g.deleteAll(),await n().logout(),await m.showToast(o("account_deleted")),await b(.5),f("progress-dialog"),this.$router.replace("/"))}}}},hs=Object.assign(ls,{__name:"perfil",setup(l){return(s,t)=>{const c=P,A=T;return d(),u("section",null,[e("div",B,[e("h4",D,[e("b",null,i(("t"in s?s.t:r(o))("nombre")),1)]),e("div",q,[C(e("input",{ref:"nombre","onUpdate:modelValue":t[0]||(t[0]=a=>s.user.nombre=a),class:"form-control py-2",type:"text",readonly:""},null,512),[[V,s.user.nombre]]),e("button",{class:p(["btn btn-sm",s.edit.nombre?"btn-success":"btn-primary"]),onClick:t[1]||(t[1]=a=>s.editName())},[s.edit.nombre?(d(),y(c,{key:0,name:"mdi:check-bold",width:"24",height:"24"})):(d(),y(c,{key:1,name:"material-symbols:edit",width:"24",height:"24"}))],2)])]),e("div",G,[e("h4",M,[e("b",null,i(("t"in s?s.t:r(o))("correo")),1)]),e("div",O,[e("input",{value:s.user.email,class:"form-control py-2",type:"text",readonly:""},null,8,F)])]),e("div",K,[e("h4",S,[e("b",null,i(("t"in s?s.t:r(o))("tarjetas_vinculadas")),1)]),e("div",U,[s.user.tarjetas.length?(d(!0),u(N,{key:0},j(s.user.tarjetas,a=>(d(),u("p",{key:a.numero,class:"m-0"},[_(c,{name:"material-symbols:credit-card-outline"}),I(" "+i(a.numero)+" ("+i(a.nombre)+")",1)]))),128)):(d(),u("p",z,i(("t"in s?s.t:r(o))("no_tarjetas")),1))])]),("Auth"in s?s.Auth:r(n))().isGuest?h("",!0):(d(),u("div",E,[e("h4",L,[e("b",null,i(("t"in s?s.t:r(o))("password")),1)]),e("div",R,[e("form",{novalidate:"",onSubmit:t[6]||(t[6]=$(a=>s.updatePass(),["prevent"]))},[e("div",H,[e("input",{ref:"current",class:p(["form-control",{"is-invalid":s.form.error}]),type:"password",autocomplete:"password",placeholder:("t"in s?s.t:r(o))("current_pass"),value:s.form.current_password,required:"",onInput:t[2]||(t[2]=a=>s.form.current_password=a.target.value),onKeyup:t[3]||(t[3]=a=>s.form.error=!1)},null,42,J),e("label",null,i(("t"in s?s.t:r(o))("current_pass")),1),e("div",Q,i(("t"in s?s.t:r(o))("pass_error")),1)]),e("div",W,[e("input",{class:p(["form-control",{"is-valid":s.isPasswordValid}]),type:"password",autocomplete:"new-password",placeholder:("t"in s?s.t:r(o))("new_pass"),value:s.form.new_password,required:"",onInput:t[4]||(t[4]=a=>s.form.new_password=a.target.value)},null,42,X),e("label",null,i(("t"in s?s.t:r(o))("new_pass")),1)]),e("div",Y,[e("input",{class:p(["form-control",{"is-valid":s.isPasswordCheckValid}]),type:"password",autocomplete:"off",placeholder:("t"in s?s.t:r(o))("password_check"),value:s.form.password_check,required:"",onInput:t[5]||(t[5]=a=>s.form.password_check=a.target.value)},null,42,Z),e("label",null,i(("t"in s?s.t:r(o))("password_check")),1)]),e("div",x,[e("button",ss,i(("t"in s?s.t:r(o))("change_pass")),1)])],32)])])),("Auth"in s?s.Auth:r(n))().isGuest?h("",!0):(d(),u("div",es,[e("h4",os,[e("b",null,i(("t"in s?s.t:r(o))("account_id")),1)]),e("div",ts,[e("input",{value:s.user.token,class:"form-control py-2",type:"text",readonly:"",onClick:t[7]||(t[7]=a=>s.copyToken(a))},null,8,rs)])])),("Auth"in s?s.Auth:r(n))().isGuest?h("",!0):(d(),u("div",as,[e("button",{class:"btn btn-danger mt-2",onClick:t[8]||(t[8]=a=>s.deleteAccount())},i(("t"in s?s.t:r(o))("delete_account")),1)])),("Auth"in s?s.Auth:r(n))().isGuest?(d(),u("div",ns,[e("p",is,[e("small",null,i(("t"in s?s.t:r(o))("nota")),1)])])):h("",!0),_(A,{message:s.dialog},null,8,["message"])])}}});export{hs as default};
