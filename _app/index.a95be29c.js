import{_ as z}from"./Icon.78bffc6d.js";import{_ as A}from"./ProgressDialog.5030f9a7.js";import{f as p,p as g,G as C,L as M,i as s,j as o,u as r,H as D,w as L,m as v,v as T,A as m,D as d,t as e,e as _,s as j,b,C as u,h as f,o as c,F as P,r as I}from"./entry.1a62485b.js";import"./nuxt-icon.vue.39305f9b.js";const U=""+globalThis.__publicAssetsURL("images/rapipass.webp"),V=""+globalThis.__publicAssetsURL("images/metro_metrobus.webp"),B=""+globalThis.__publicAssetsURL("images/metrobus.webp"),S=["onClick"],E={class:"flex-grow-1"},G={class:"text-primary-emphasis m-0"},R={class:"info mx-2 small"},N={class:"m-0"},O={class:"m-0"},q={class:"m-0"},F={class:"m-0"},H={class:"text-nowrap"},Z={class:"actions d-flex flex-column"},J={class:"image mb-2 mt-2"},K=["width","height"],Q=["width","height"],W=["width","height"],X={class:"d-grid"},Y=["onClick"],x={key:0,class:"text-center mt-3"},tt={class:"small m-0"},st={class:"position-fixed bottom-0 end-0 m-3"},et={class:"btn btn-primary rounded-circle p-1 shadow",role:"button","data-bs-toggle":"modal","data-bs-target":"#add-dialog"},at={id:"add-dialog",class:"modal fade",tabindex:"-1","aria-labelledby":"add-dialog-label","aria-hidden":"true","data-bs-backdrop":"static"},ot={class:"modal-dialog modal-dialog-centered"},it={class:"modal-content"},rt={class:"modal-header"},nt={id:"add-dialog-label",class:"modal-title fs-5 text-primary-emphasis"},dt={class:"modal-body text-center"},lt={class:"mb-3 position-relative form-floating"},mt=["placeholder"],ht={class:"invalid-tooltip"},pt={class:"mb-3 position-relative form-floating"},ut=["placeholder"],ct={class:"invalid-tooltip"},gt={class:"d-flex justify-content-end"},_t={class:"btn btn-danger me-2",type:"button","data-bs-dismiss":"modal"},bt={class:"btn btn-primary",type:"submit",role:"button"},ft={name:"AppPage",data(){return{tarjetas:[],size:100,form:{numero:"",nombre:""},progress:""}},async mounted(){if(m().exists&&(this.tarjetas=await d.getTarjetas(),!m().user.updated&&!this.tarjetas.length&&!m().isGuest)){this.progress=e("adding_tarjetas"),await _(.5),j("progress-dialog");const{email:l,token:t}=m().user,n=await b.getDetallesTarjetas({email:l,token:t})||[];for(const a of n){const{changes:h}=await d.insertTarjeta(a);await d.insertMovimientos(a),h>0&&await u.showToast(`${e("tarjeta_added")}: ${a.numero}`)}this.tarjetas=await d.getTarjetas(),await m().setUpdated(),await _(.5),f("progress-dialog")}},methods:{async addTarjeta(){this.progress=e("adding_tarjeta");const l=this.$refs.add;if(l.checkValidity()){f("add-dialog"),j("progress-dialog");const{nombre:t,numero:n}=this.form,{tarjeta:a,error:h,error_key:i}=await b.getTarjetaAPI(n);if(a&&!h){if(a.nombre=String(t).trim(),a.fecha_added=new Date().toISOString().replace("T"," ").replace("Z",""),await d.tarjetaExists(a.numero))await u.showToast(`${e("existe_tarjeta")}: ${a.numero}`);else{const{error:y,error_key:k}=m().isGuest?{error:!1}:await b.addTarjeta({nombre:a.nombre,numero:a.numero,email:m().user.email,token:m().user.token}),{changes:$}=await d.insertTarjeta(a);$>0&&!y?(await d.insertMovimientos(a),await u.showToast(`${e("tarjeta_added")}: ${a.numero}`)):await u.showToast(e(k)),this.tarjetas=await d.getTarjetas()}this.form={numero:"",nombre:""}}else await u.showToast(e(i),"long");await _(.5),f("progress-dialog"),l.classList.remove("was-validated")}else l.classList.add("was-validated")},openCard(l){this.$router.push(`${l}`)},async updateTarjeta(l){this.progress=e("actualizando_tarjeta"),j("progress-dialog");const{tarjeta:t,error:n,error_key:a}=await b.getTarjetaAPI(l);if(t&&!n){const{changes:h}=await d.updateTarjeta(t);h>0&&(await d.deleteMovimientos(l),await d.insertMovimientos(t),await u.showToast(`${e("tarjeta_actualizada")}: ${t.numero}`),this.tarjetas=await d.getTarjetas())}else await u.showToast(e(a),"long");await _(.5),f("progress-dialog")}}},yt=Object.assign(ft,{setup(l){return(t,n)=>{const a=z,h=A;return c(),p("section",null,[g(M,{name:"tab"},{default:C(()=>[(c(!0),p(P,null,I(t.tarjetas,i=>(c(),p("div",{key:i.numero,class:"bg-body-tertiary border rounded d-flex p-2 mb-2 shadow",role:"button",onClick:w=>t.openCard(i.numero)},[s("div",E,[s("h4",G,[s("b",null,o(i.nombre),1)]),s("div",R,[s("p",N,o(("t"in t?t.t:r(e))("numero"))+": "+o(i.numero),1),s("p",O,o(("t"in t?t.t:r(e))("estado"))+": "+o(i.estado),1),s("p",q,o(("t"in t?t.t:r(e))("tipo"))+": "+o(i.tipo),1),s("p",F,o(("t"in t?t.t:r(e))("fecha"))+": "+o(i.fecha),1),s("h3",H,[s("b",null,o(("t"in t?t.t:r(e))("saldo"))+": B/. "+o(i.saldo),1)])])]),s("div",Z,[s("div",J,[i.tipo===("t"in t?t.t:r(e))("tarjeta_rapipass")?(c(),p("img",{key:0,class:"img-fluid",src:U,width:t.size,height:t.size},null,8,K)):i.tipo===("t"in t?t.t:r(e))("tarjeta_normal")?(c(),p("img",{key:1,class:"img-fluid",src:V,width:t.size,height:t.size},null,8,Q)):(c(),p("img",{key:2,src:B,class:"img-fluid",width:t.size,height:t.size},null,8,W))]),s("div",X,[s("button",{class:"btn btn-primary btn-sm",role:"button",onClick:w=>{w.stopPropagation(),t.updateTarjeta(i.numero)}},[g(a,{name:"refresh",size:"md"})],8,Y)])])],8,S))),128))]),_:1}),t.tarjetas.length?(c(),p("div",x,[s("p",tt,[s("small",null,o(("t"in t?t.t:r(e))("tarjetas_note")),1)])])):D("",!0),s("div",st,[s("button",et,[g(a,{name:"plus",size:"lg"})])]),s("div",at,[s("div",ot,[s("div",it,[s("div",rt,[s("h1",nt,o(("t"in t?t.t:r(e))("add_tarjeta")),1)]),s("div",dt,[s("form",{ref:"add",novalidate:"",onSubmit:n[2]||(n[2]=L(i=>t.addTarjeta(),["prevent"]))},[s("div",lt,[v(s("input",{"onUpdate:modelValue":n[0]||(n[0]=i=>t.form.nombre=i),class:"form-control",type:"text",placeholder:("t"in t?t.t:r(e))("nombre"),required:""},null,8,mt),[[T,t.form.nombre]]),s("label",null,o(("t"in t?t.t:r(e))("nombre")),1),s("div",ht,o(("t"in t?t.t:r(e))("obligatorio")),1)]),s("div",pt,[v(s("input",{"onUpdate:modelValue":n[1]||(n[1]=i=>t.form.numero=i),class:"form-control",type:"number",pattern:"[0-9]",placeholder:("t"in t?t.t:r(e))("numero_tarjeta"),required:""},null,8,ut),[[T,t.form.numero]]),s("label",null,o(("t"in t?t.t:r(e))("numero_tarjeta")),1),s("div",ct,o(("t"in t?t.t:r(e))("error_tarjeta")),1)]),s("div",gt,[s("button",_t,o(("t"in t?t.t:r(e))("cancel")),1),s("button",bt,o(("t"in t?t.t:r(e))("add")),1)])],544)])])])]),g(h,{message:t.progress},null,8,["message"])])}}});export{yt as default};
