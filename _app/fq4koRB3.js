import{_ as E}from"./DmTzxgm0.js";import{_ as N}from"./Dr2IUEAg.js";import{_ as G,o as j,c as y,a as t,t as o,i as s,e as a,L as O,A as U,M as $,N as q,O as R,Q,D as d,g as b,s as k,f as v,C as m,h as C,b as w,w as Z,F as H,r as J,j as K,R as W,p as X,l as Y,m as P,v as S,S as x}from"./zeH_EUjw.js";import"./3YnLAFXT.js";const tt={},et={id:"limit-dialog",class:"modal fade",tabindex:"-1","aria-labelledby":"progress-dialog-label","aria-hidden":"true","data-bs-backdrop":"static"},at={class:"modal-dialog modal-dialog-centered"},st={class:"modal-content"},ot={class:"modal-header"},it={id:"progress-dialog-label",class:"modal-title text-primary-emphasis"},nt={class:"modal-body"},rt={class:"m-0"},dt={class:"modal-footer"},lt={class:"btn btn-primary w-100",type:"button","data-bs-dismiss":"modal"};function ct(u,c){return j(),y("div",et,[t("div",at,[t("div",st,[t("div",ot,[t("h5",it,[t("strong",null,o(("t"in u?u.t:s(a))("limit_tittle")),1)])]),t("div",nt,[t("p",rt,o(("t"in u?u.t:s(a))("limit_message")),1)]),t("div",dt,[t("button",lt,o(("t"in u?u.t:s(a))("entendido")),1)])])])])}const mt=G(tt,[["render",ct]]),ut=["onClick"],ht={class:"flex-grow-1"},_t={class:"text-primary-emphasis m-0"},gt={class:"info mx-2 small"},pt={class:"m-0"},bt={class:"m-0"},ft={class:"m-0"},vt={class:"m-0"},wt={class:"text-nowrap"},jt={class:"actions d-flex flex-column"},yt={class:"image mb-2 mt-2"},Tt=["src","width","height"],$t={class:"d-grid"},kt=["onClick"],Ct={key:0,class:"text-center mt-3"},It={class:"small m-0"},Mt={class:"position-fixed bottom-0 end-0 m-3"},Dt={class:"btn btn-primary rounded-circle p-1 shadow",role:"button","data-bs-toggle":"modal","data-bs-target":"#add-dialog"},At={id:"add-dialog",class:"modal fade",tabindex:"-1","aria-labelledby":"add-dialog-label","aria-hidden":"true","data-bs-backdrop":"static"},Lt={class:"modal-dialog modal-dialog-centered"},Pt={class:"modal-content"},St={class:"modal-header"},Vt={id:"add-dialog-label",class:"modal-title fs-5 text-primary-emphasis"},zt={class:"modal-body text-center"},Bt={class:"mb-3 position-relative form-floating"},Ft=["placeholder"],Et={class:"invalid-tooltip"},Nt={class:"mb-3 position-relative form-floating"},Gt=["placeholder"],Ot={class:"invalid-tooltip"},Ut={class:"d-flex justify-content-end"},qt={class:"btn btn-danger me-2",type:"button","data-bs-dismiss":"modal"},Rt={class:"btn btn-primary",type:"submit",role:"button"},Kt=O({__name:"index",setup(u){const c=U(),h=$([]),A=$(0),V=$(4),T=$(""),_=q({numero:"",nombre:""}),L={width:100,height:63},I=R(()=>A.value>V.value),z=e=>x(`/app/${e}`),B=async e=>{T.value=a("adding_tarjeta");const r=e.currentTarget;if(!r.checkValidity())return r.classList.add("was-validated");C("add-dialog"),k("progress-dialog");const{tarjeta:i,error:g,error_key:l}=await v.getTarjetaAPI(_.value.numero);if(i&&!g){if(i.nombre=_.value.nombre,i.fecha_added=new Date().toISOString().replace("T"," ").replace("Z",""),await d.tarjetaExists(i.numero))await m.showToast(`${a("existe_tarjeta")}: ${i.numero}`);else{const{error:p,error_key:M}=c.isGuest?{error:!1}:await v.addTarjeta({nombre:i.nombre,numero:i.numero,email:c.user.email,token:c.user.token});await d.insertTarjeta(i)>0&&!p?(await d.insertMovimientos(i),await m.showToast(`${a("tarjeta_added")}: ${i.numero}`)):await m.showToast(a(M)),h.value=await d.getTarjetas()}_.reset()}else await m.showToast(a(l||"error"),"long");await b(.5),C("progress-dialog"),r.classList.remove("was-validated")},F=async(e,r)=>{e.stopPropagation(),T.value=a("actualizando_tarjeta"),k("progress-dialog");const{tarjeta:i,error:g,error_key:l}=await v.getTarjetaAPI(r,!0);i&&!g?await d.updateTarjeta(i)>0&&(await d.deleteMovimientos(r),await d.insertMovimientos(i),await m.showToast(`${a("tarjeta_actualizada")}: ${i.numero}`),h.value=await d.getTarjetas()):await m.showToast(a(l||"error"),"long"),await b(.5),C("progress-dialog")};return Q(async()=>{if(!c.exists||(h.value=await d.getTarjetas(),h.value.length||c.user.updated||c.isGuest))return;T.value=a("adding_tarjetas"),await b(.5),k("progress-dialog");const{email:e,token:r}=c.user,{error:i,error_key:g,tarjetas:l}=await v.getTarjetas({email:e,token:r})||[];let n=[];i&&await m.showToast(a(g),"long"),l&&(A.value=l.length,I.value?n=l||[]:n=await v.getDetallesTarjetas(l)||[]);for(const f of n)await d.insertTarjeta(f)>0&&!I.value&&await d.insertMovimientos(f);const p=await d.getTarjetas(),M=p.entries();for(const[f,D]of M){if(h.value.push(D),await m.showToast(`${a("tarjeta_added")}: ${D.numero}`),p.length-1===f)break;await b(.5)}await c.setUpdated(),await b(.5),C("progress-dialog"),I.value&&(await b(.5),k("limit-dialog"))}),(e,r)=>{const i=E,g=N,l=mt;return j(),y("section",null,[w(W,{name:"tab"},{default:Z(()=>[(j(!0),y(H,null,J(s(h),n=>(j(),y("div",{key:n.numero,class:"bg-body-tertiary border rounded d-flex p-2 mb-2 shadow",role:"button",onClick:p=>z(n.numero)},[t("div",ht,[t("h4",_t,[t("b",null,o(n.nombre),1)]),t("div",gt,[t("p",pt,o(("t"in e?e.t:s(a))("numero"))+": "+o(n.numero),1),t("p",bt,o(("t"in e?e.t:s(a))("estado"))+": "+o(n.estado),1),t("p",ft,o(("t"in e?e.t:s(a))("tipo"))+": "+o(n.tipo),1),t("p",vt,o(("t"in e?e.t:s(a))("fecha"))+": "+o(n.fecha),1),t("h3",wt,[t("b",null,o(("t"in e?e.t:s(a))("saldo"))+": B/. "+o(n.saldo),1)])])]),t("div",jt,[t("div",yt,[t("img",{class:"img-fluid rounded shadow-sm",src:`/images/${("getCardImage"in e?e.getCardImage:s(K))(n.tipo)}`,width:L.width,height:L.height},null,8,Tt)]),t("div",$t,[t("button",{class:"btn btn-primary btn-sm",role:"button",onClick:p=>F(p,n.numero)},[w(i,{name:"refresh",size:"md"})],8,kt)])])],8,ut))),128))]),_:1}),s(h).length?(j(),y("div",Ct,[t("p",It,[t("small",null,o(("t"in e?e.t:s(a))("tarjetas_note")),1)])])):X("",!0),t("div",Mt,[t("button",Dt,[w(i,{name:"plus",size:"lg"})])]),t("div",At,[t("div",Lt,[t("div",Pt,[t("div",St,[t("h1",Vt,[t("strong",null,o(("t"in e?e.t:s(a))("add_tarjeta")),1)])]),t("div",zt,[t("form",{novalidate:"",onSubmit:Y(B,["prevent"])},[t("div",Bt,[P(t("input",{"onUpdate:modelValue":r[0]||(r[0]=n=>s(_).nombre=n),class:"form-control",type:"text",placeholder:("t"in e?e.t:s(a))("nombre"),required:""},null,8,Ft),[[S,s(_).nombre,void 0,{trim:!0}]]),t("label",null,o(("t"in e?e.t:s(a))("nombre")),1),t("div",Et,o(("t"in e?e.t:s(a))("obligatorio")),1)]),t("div",Nt,[P(t("input",{"onUpdate:modelValue":r[1]||(r[1]=n=>s(_).numero=n),class:"form-control",type:"number",pattern:"[0-9]",placeholder:("t"in e?e.t:s(a))("numero_tarjeta"),required:""},null,8,Gt),[[S,s(_).numero]]),t("label",null,o(("t"in e?e.t:s(a))("numero_tarjeta")),1),t("div",Ot,o(("t"in e?e.t:s(a))("error_tarjeta")),1)]),t("div",Ut,[t("button",qt,o(("t"in e?e.t:s(a))("cancel")),1),t("button",Rt,o(("t"in e?e.t:s(a))("add")),1)])],32)])])])]),w(g,{message:s(T)},null,8,["message"]),w(l)])}}});export{Kt as default};
