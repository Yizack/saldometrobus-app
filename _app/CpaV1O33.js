import{_ as T}from"./ClMqBJzL.js";import{_ as V}from"./DHg8Ht8L.js";import{L as P,o as l,c as u,a as e,t as i,i as r,e as o,m as h,v as c,A as a,n as w,b as f,w as N,H as k,T as $,p,F as j,r as B,l as D,D as v,f as y,C as m,s as A,g as _,h as g}from"./D8wMuaWs.js";import"./DeeFIECk.js";const G={class:"bg-body-tertiary border rounded p-2 mb-2 shadow"},U={class:"text-primary-emphasis m-0"},M={class:"input-group p-2"},q={class:"bg-body-tertiary border rounded p-2 mb-2 shadow"},I={class:"text-primary-emphasis m-0"},S={class:"m-2"},F=["value"],L={class:"bg-body-tertiary border rounded p-2 mb-2 shadow"},R={class:"text-primary-emphasis m-0"},z={class:"m-2"},E={class:"ms-2 my-0"},H={key:1,class:"m-0"},K={key:0,class:"bg-body-tertiary border rounded p-2 mb-2 shadow"},O={class:"text-primary-emphasis m-0"},J={class:"m-2"},Q={class:"mb-3 position-relative form-floating"},W=["placeholder"],X={class:"invalid-tooltip"},Y={class:"mb-3 form-floating"},Z=["placeholder"],x={class:"mb-3 form-floating"},ss=["placeholder"],es={class:"d-grid"},os={class:"btn btn-primary",type:"submit",role:"button"},ts={key:1,class:"bg-body-tertiary border rounded p-2 shadow"},rs={class:"text-primary-emphasis m-0"},as={class:"m-2"},ns=["value"],is={key:2,class:"d-grid"},ds={key:3,class:"text-center mt-3"},ls={class:"small m-0"},us={data(){return{dialog:"",edit:{nombre:!1},user:{nombre:a().user.nombre,email:a().user.email,token:a().user.token,tarjetas:[]},form:{current_password:"",new_password:"",password_check:"",error:!1}}},computed:{isPasswordValid(){return this.form.new_password.length>=3&&this.form.current_password!==this.form.new_password&&this.form.current_password.length>0},isPasswordCheckValid(){return this.isPasswordValid&&this.form.new_password===this.form.password_check}},async mounted(){this.user.tarjetas=await v.getTarjetas()},methods:{async editName(){this.edit.nombre=!this.edit.nombre,this.user.nombre=this.user.nombre.trim();const d=this.$refs.nombre;if(this.edit.nombre){const s=this.user.nombre.length;d.setSelectionRange(s,s),d.focus(),d.removeAttribute("readonly")}else{if(this.user.nombre!==a().user.nombre){const{error:s,error_key:t}=await y.updateName({nombre:this.user.nombre,email:a().user.email,token:a().user.token||""});s?(this.user.nombre=a().user.nombre,await m.showToast(o(t))):(a().updateName(this.user.nombre),await m.showToast(o("name_updated")))}d.setAttribute("readonly","true"),d.blur()}},async updatePass(){if(this.isPasswordValid&&this.isPasswordCheckValid){this.dialog=o("updating_pass"),A("progress-dialog");const{error:d,error_key:s}=await y.userPassUpdate({current_password:this.form.current_password,new_password:this.form.new_password,email:a().user.email,token:a().user.token});d?(s==="pass_error"&&(this.form.error=!0,this.$refs.current.focus()),await m.showToast(o(s),"long")):(await m.showToast(o("pass_updated"),"long"),this.form={current_password:"",new_password:"",password_check:"",error:!1})}await _(.5),g("progress-dialog")},copyToken(d){d.target.select(),m.writeToClipboard(this.user.token)},async deleteAccount(){if(await m.confirm(o("delete_account"),o("delete_account_sure"))){this.dialog=o("deleting_account"),A("progress-dialog");const{error:s,error_key:t}=await y.deleteAccount({email:a().user.email,token:a().user.token});s?(await m.showToast(o(t)),await _(.5),g("progress-dialog")):(await v.deleteAll(),await a().logout(),await m.showToast(o("account_deleted")),await _(.5),g("progress-dialog"),this.$router.replace("/"))}}}},ws=P({...us,__name:"perfil",setup(d){return(s,t)=>{const b=T,C=V;return l(),u("section",null,[e("div",G,[e("h4",U,[e("b",null,i(("t"in s?s.t:r(o))("nombre")),1)]),e("div",M,[h(e("input",{ref:"nombre","onUpdate:modelValue":t[0]||(t[0]=n=>s.user.nombre=n),class:"form-control py-2",type:"text",readonly:""},null,512),[[c,s.user.nombre]]),("Auth"in s?s.Auth:r(a))().isGuest?p("",!0):(l(),u("button",{key:0,class:w(["btn btn-sm",s.edit.nombre?"btn-success":"btn-primary"]),style:{width:"3rem"},onClick:t[1]||(t[1]=n=>s.editName())},[f($,{name:"tab",mode:"out-in"},{default:N(()=>[s.edit.nombre?(l(),k(b,{key:0,name:"check"})):(l(),k(b,{key:1,name:"edit"}))]),_:1})],2))])]),e("div",q,[e("h4",I,[e("b",null,i(("t"in s?s.t:r(o))("correo")),1)]),e("div",S,[e("input",{value:s.user.email,class:"form-control py-2",type:"text",readonly:""},null,8,F)])]),e("div",L,[e("h4",R,[e("b",null,i(("t"in s?s.t:r(o))("tarjetas_vinculadas")),1)]),e("div",z,[s.user.tarjetas.length?(l(!0),u(j,{key:0},B(s.user.tarjetas,n=>(l(),u("div",{key:n.numero,class:"d-flex align-items-center"},[f(b,{name:"card"}),e("p",E,i(n.numero)+" ("+i(n.nombre)+")",1)]))),128)):(l(),u("p",H,i(("t"in s?s.t:r(o))("no_tarjetas")),1))])]),("Auth"in s?s.Auth:r(a))().isGuest?p("",!0):(l(),u("div",K,[e("h4",O,[e("b",null,i(("t"in s?s.t:r(o))("password")),1)]),e("div",J,[e("form",{novalidate:"",onSubmit:t[6]||(t[6]=D(n=>s.updatePass(),["prevent"]))},[e("div",Q,[h(e("input",{ref:"current","onUpdate:modelValue":t[2]||(t[2]=n=>s.form.current_password=n),class:w(["form-control",{"is-invalid":s.form.error}]),type:"password",autocomplete:"password",placeholder:("t"in s?s.t:r(o))("current_pass"),required:"",onKeyup:t[3]||(t[3]=n=>s.form.error=!1)},null,42,W),[[c,s.form.current_password]]),e("label",null,i(("t"in s?s.t:r(o))("current_pass")),1),e("div",X,i(("t"in s?s.t:r(o))("pass_error")),1)]),e("div",Y,[h(e("input",{"onUpdate:modelValue":t[4]||(t[4]=n=>s.form.new_password=n),class:w(["form-control",{"is-valid":s.isPasswordValid}]),type:"password",autocomplete:"new-password",placeholder:("t"in s?s.t:r(o))("new_pass"),required:""},null,10,Z),[[c,s.form.new_password]]),e("label",null,i(("t"in s?s.t:r(o))("new_pass")),1)]),e("div",x,[h(e("input",{"onUpdate:modelValue":t[5]||(t[5]=n=>s.form.password_check=n),class:w(["form-control",{"is-valid":s.isPasswordCheckValid}]),type:"password",autocomplete:"off",placeholder:("t"in s?s.t:r(o))("password_check"),required:""},null,10,ss),[[c,s.form.password_check]]),e("label",null,i(("t"in s?s.t:r(o))("password_check")),1)]),e("div",es,[e("button",os,i(("t"in s?s.t:r(o))("change_pass")),1)])],32)])])),("Auth"in s?s.Auth:r(a))().isGuest?p("",!0):(l(),u("div",ts,[e("h4",rs,[e("b",null,i(("t"in s?s.t:r(o))("account_id")),1)]),e("div",as,[e("input",{value:s.user.token,class:"form-control py-2",type:"text",readonly:"",onClick:t[7]||(t[7]=n=>s.copyToken(n))},null,8,ns)])])),("Auth"in s?s.Auth:r(a))().isGuest?p("",!0):(l(),u("div",is,[e("button",{class:"btn btn-danger mt-2",onClick:t[8]||(t[8]=n=>s.deleteAccount())},i(("t"in s?s.t:r(o))("delete_account")),1)])),("Auth"in s?s.Auth:r(a))().isGuest?(l(),u("div",ds,[e("p",ls,[e("small",null,i(("t"in s?s.t:r(o))("nota")),1)])])):p("",!0),f(C,{message:s.dialog},null,8,["message"])])}}});export{ws as default};
