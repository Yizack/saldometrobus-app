import{_ as F}from"./D-1Ac_3t.js";import{_ as N}from"./CAFKyNNH.js";import{_ as O}from"./CQbxdfOB.js";import{c as T,o as b,a as t,t as o,f as s,g as e,e as q,A as G,B as k,q as U,O as R,P as r,k as w,s as $,Q as y,C as u,l as C,b as v,E as Q,w as M,R as Z,h as H,i as B,v as P,M as J,N as K,I as W,T as X,S as Y,n as x}from"./Dm3BibmY.js";import{_ as tt}from"./DlAUqK2U.js";import{u as at}from"./B31iADRx.js";import"./Dz6xubxL.js";const et={},st={id:"limit-dialog",class:"modal fade",tabindex:"-1","aria-labelledby":"progress-dialog-label","aria-hidden":"true","data-bs-backdrop":"static"},ot={class:"modal-dialog modal-dialog-centered"},it={class:"modal-content"},nt={class:"modal-header"},lt={id:"progress-dialog-label",class:"modal-title text-primary-emphasis"},rt={class:"modal-body"},dt={class:"m-0"},ct={class:"modal-footer"},mt={class:"btn btn-primary w-100",type:"button","data-bs-dismiss":"modal"};function ut(_,m){return b(),T("div",st,[t("div",ot,[t("div",it,[t("div",nt,[t("h5",lt,[t("strong",null,o(("t"in _?_.t:s(e))("limit_tittle")),1)])]),t("div",rt,[t("p",dt,o(("t"in _?_.t:s(e))("limit_message")),1)]),t("div",ct,[t("button",mt,o(("t"in _?_.t:s(e))("entendido")),1)])])])])}const _t=Object.assign(tt(et,[["render",ut]]),{__name:"LimitDialog"}),ht={class:"d-flex"},pt={class:"flex-grow-1"},gt={class:"info mx-2 small"},ft={class:"m-0"},bt={key:0},wt={class:"m-0"},vt={class:"m-0"},Tt={class:"m-0"},yt={class:"text-nowrap m-0"},jt={key:1},kt={class:"actions d-flex flex-column"},$t={class:"image mb-2"},Ct=["src","width","height"],It={class:"d-grid"},Mt=["onClick"],Dt={key:0,class:"text-center mt-3"},At={class:"small m-0"},Bt={class:"position-fixed bottom-0 end-0 m-3"},Pt={class:"btn btn-primary rounded-circle p-1 shadow",role:"button","data-bs-toggle":"modal","data-bs-target":"#add-dialog"},Lt={id:"add-dialog",class:"modal fade",tabindex:"-1","aria-labelledby":"add-dialog-label","aria-hidden":"true","data-bs-backdrop":"static"},zt={class:"modal-dialog modal-dialog-centered"},St={class:"modal-content"},Vt={class:"modal-header"},Et={id:"add-dialog-label",class:"modal-title fs-5 text-primary-emphasis"},Ft={class:"modal-body text-center"},Nt={class:"mb-3 position-relative form-floating"},Ot=["placeholder"],qt={class:"invalid-tooltip"},Gt={class:"mb-3 position-relative form-floating"},Ut=["placeholder"],Rt={class:"invalid-tooltip"},Qt={class:"d-flex justify-content-end"},Zt={class:"btn btn-danger me-2",type:"button","data-bs-dismiss":"modal"},Ht={class:"btn btn-primary",type:"submit",role:"button"},aa=q({__name:"index",setup(_){const m=G(),h=k([]),D=k(0),L=k(4),j=k(""),p=at({numero:"",nombre:""}),A={width:100,height:63},I=U(()=>D.value>L.value),z=a=>{if(!a.saldo)return u.showToast(e("actualiza_tarjeta"),"long");x(`/app/${a.numero}`)},S=async a=>{j.value=e("adding_tarjeta");const l=a.currentTarget;if(!l.checkValidity())return l.classList.add("was-validated");C("add-dialog"),$("progress-dialog");const{tarjeta:i,error:g,error_key:c}=await y.getTarjetaAPI(p.value.numero);if(i&&!g){if(i.nombre=p.value.nombre,i.fecha_added=new Date().toISOString().replace("T"," ").replace("Z",""),await r.tarjetaExists(i.numero))await u.showToast(`${e("existe_tarjeta")}: ${i.numero}`);else{const{error:n,error_key:d}=m.isGuest?{error:!1}:await y.addTarjeta({nombre:i.nombre,numero:i.numero,email:m.user.email,token:m.user.token});await r.insertTarjeta(i)>0&&!n?(await r.insertMovimientos(i),await u.showToast(`${e("tarjeta_added")}: ${i.numero}`)):await u.showToast(e(d)),h.value=await r.getTarjetas()}p.reset()}else await u.showToast(e(c||"error"),"long");await w(.5),C("progress-dialog"),l.classList.remove("was-validated")},V=async(a,l)=>{a.stopPropagation(),j.value=e("actualizando_tarjeta"),$("progress-dialog");const{tarjeta:i,error:g,error_key:c}=await y.getTarjetaAPI(l,!0);i&&!g?await r.updateTarjeta(i)>0&&(await r.deleteMovimientos(l),await r.insertMovimientos(i),await u.showToast(`${e("tarjeta_actualizada")}: ${i.numero}`),h.value=await r.getTarjetas()):await u.showToast(e(c||"error"),"long"),await w(.5),C("progress-dialog")};return R(async()=>{if(!m.exists||(h.value=await r.getTarjetas(),h.value.length||m.user.updated||m.isGuest))return;j.value=e("adding_tarjetas"),await w(.5),$("progress-dialog");const{email:a,token:l}=m.user,{error:i,error_key:g,tarjetas:c}=await y.getTarjetas({email:a,token:l})||[];let f=[];i&&await u.showToast(e(g),"long"),c&&(D.value=c.length,I.value?f=c||[]:f=await y.getDetallesTarjetas(c)||[]);for(const d of f)await r.insertTarjeta(d)>0&&!I.value&&await r.insertMovimientos(d);const n=await r.getTarjetas();for(const d of n)h.value.push(d),d.saldo&&await u.showToast(`${e("tarjeta_added")}: ${d.numero}`),await w(.5);await m.setUpdated(),await w(.5),C("progress-dialog"),I.value&&(await w(.5),$("limit-dialog"))}),(a,l)=>{const i=F,g=N,c=O,f=_t;return b(),T("section",null,[v(Z,{name:"tab"},{default:M(()=>[(b(!0),T(J,null,K(s(h),n=>(b(),W(g,{key:n.numero,title:n.nombre,p2:"",role:"button",onClick:d=>z(n)},{default:M(()=>[t("div",ht,[t("div",pt,[t("div",gt,[t("p",ft,[t("b",null,o(("t"in a?a.t:s(e))("numero"))+": "+o(n.numero),1)]),v(X,{name:"fade",mode:"out-in"},{default:M(()=>[n.saldo?(b(),T("div",bt,[t("p",wt,o(("t"in a?a.t:s(e))("estado"))+": "+o(n.estado),1),t("p",vt,o(("t"in a?a.t:s(e))("tipo"))+": "+o(n.tipo),1),t("p",Tt,o(("t"in a?a.t:s(e))("fecha"))+": "+o(n.fecha),1),t("h3",yt,[t("b",null,o(("t"in a?a.t:s(e))("saldo"))+": B/. "+o(n.saldo),1)])])):(b(),T("div",jt,l[2]||(l[2]=[t("p",{class:"placeholder-glow m-0"},[t("span",{class:"placeholder col-6"})],-1),t("p",{class:"placeholder-glow m-0"},[t("span",{class:"placeholder col-5"})],-1),t("p",{class:"placeholder-glow m-0"},[t("span",{class:"placeholder col-7"})],-1),t("h3",{class:"placeholder-glow"},[t("span",{class:"placeholder col-6"})],-1)])))]),_:2},1024)])]),t("div",kt,[t("div",$t,[t("img",{class:"img-fluid rounded shadow-sm",src:`/images/${("getCardImage"in a?a.getCardImage:s(Y))(n.tipo)}`,width:A.width,height:A.height},null,8,Ct)]),t("div",It,[t("button",{class:"btn btn-secondary btn-sm py-2",role:"button",onClick:d=>V(d,n.numero)},[v(i,{name:"refresh",size:"md"})],8,Mt)])])])]),_:2},1032,["title","onClick"]))),128))]),_:1}),s(h).length?(b(),T("div",Dt,[t("p",At,[t("small",null,o(("t"in a?a.t:s(e))("tarjetas_note")),1)])])):Q("",!0),t("div",Bt,[t("button",Pt,[v(i,{name:"plus",size:"lg"})])]),t("div",Lt,[t("div",zt,[t("div",St,[t("div",Vt,[t("h1",Et,[t("strong",null,o(("t"in a?a.t:s(e))("add_tarjeta")),1)])]),t("div",Ft,[t("form",{novalidate:"",onSubmit:H(S,["prevent"])},[t("div",Nt,[B(t("input",{"onUpdate:modelValue":l[0]||(l[0]=n=>s(p).nombre=n),class:"form-control",type:"text",placeholder:("t"in a?a.t:s(e))("nombre"),required:""},null,8,Ot),[[P,s(p).nombre,void 0,{trim:!0}]]),t("label",null,o(("t"in a?a.t:s(e))("nombre")),1),t("div",qt,o(("t"in a?a.t:s(e))("obligatorio")),1)]),t("div",Gt,[B(t("input",{"onUpdate:modelValue":l[1]||(l[1]=n=>s(p).numero=n),class:"form-control",type:"number",pattern:"[0-9]",placeholder:("t"in a?a.t:s(e))("numero_tarjeta"),required:""},null,8,Ut),[[P,s(p).numero]]),t("label",null,o(("t"in a?a.t:s(e))("numero_tarjeta")),1),t("div",Rt,o(("t"in a?a.t:s(e))("error_tarjeta")),1)]),t("div",Qt,[t("button",Zt,o(("t"in a?a.t:s(e))("cancel")),1),t("button",Ht,o(("t"in a?a.t:s(e))("add")),1)])],32)])])])]),v(c,{message:s(j)},null,8,["message"]),v(f)])}}});export{aa as default};
