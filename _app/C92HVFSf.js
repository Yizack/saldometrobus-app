import{_ as N}from"./C69am6jn.js";import{_ as G}from"./COOQ_KeX.js";import{_ as O,o as b,c as f,a as t,t as o,i as s,e as a,L as U,A as q,M as k,N as R,O as Q,Q as Z,D as r,g as w,s as $,f as T,C as m,h as C,b as v,w as P,F as H,r as J,T as K,j as W,R as X,p as Y,l as x,m as z,v as S,S as tt}from"./Cu-lQnZ7.js";import"./D_8zSD3I.js";const et={},at={id:"limit-dialog",class:"modal fade",tabindex:"-1","aria-labelledby":"progress-dialog-label","aria-hidden":"true","data-bs-backdrop":"static"},st={class:"modal-dialog modal-dialog-centered"},ot={class:"modal-content"},it={class:"modal-header"},nt={id:"progress-dialog-label",class:"modal-title text-primary-emphasis"},lt={class:"modal-body"},rt={class:"m-0"},dt={class:"modal-footer"},ct={class:"btn btn-primary w-100",type:"button","data-bs-dismiss":"modal"};function mt(u,c){return b(),f("div",at,[t("div",st,[t("div",ot,[t("div",it,[t("h5",nt,[t("strong",null,o(("t"in u?u.t:s(a))("limit_tittle")),1)])]),t("div",lt,[t("p",rt,o(("t"in u?u.t:s(a))("limit_message")),1)]),t("div",dt,[t("button",ct,o(("t"in u?u.t:s(a))("entendido")),1)])])])])}const ut=O(et,[["render",mt]]),ht=["onClick"],_t={class:"flex-grow-1"},pt={class:"text-primary-emphasis m-0"},gt={class:"info mx-2 small"},bt={class:"m-0"},ft={key:0},wt={class:"m-0"},vt={class:"m-0"},yt={class:"m-0"},Tt={class:"text-nowrap"},jt={key:1},kt={class:"actions d-flex flex-column"},$t={class:"image mb-2 mt-2"},Ct=["src","width","height"],It={class:"d-grid"},Mt=["onClick"],Dt={key:0,class:"text-center mt-3"},At={class:"small m-0"},Lt={class:"position-fixed bottom-0 end-0 m-3"},Pt={class:"btn btn-primary rounded-circle p-1 shadow",role:"button","data-bs-toggle":"modal","data-bs-target":"#add-dialog"},zt={id:"add-dialog",class:"modal fade",tabindex:"-1","aria-labelledby":"add-dialog-label","aria-hidden":"true","data-bs-backdrop":"static"},St={class:"modal-dialog modal-dialog-centered"},Vt={class:"modal-content"},Bt={class:"modal-header"},Ft={id:"add-dialog-label",class:"modal-title fs-5 text-primary-emphasis"},Et={class:"modal-body text-center"},Nt={class:"mb-3 position-relative form-floating"},Gt=["placeholder"],Ot={class:"invalid-tooltip"},Ut={class:"mb-3 position-relative form-floating"},qt=["placeholder"],Rt={class:"invalid-tooltip"},Qt={class:"d-flex justify-content-end"},Zt={class:"btn btn-danger me-2",type:"button","data-bs-dismiss":"modal"},Ht={class:"btn btn-primary",type:"submit",role:"button"},Yt=U({__name:"index",setup(u){const c=q(),h=k([]),A=k(0),V=k(4),j=k(""),_=R({numero:"",nombre:""}),L={width:100,height:63},I=Q(()=>A.value>V.value),B=e=>{if(!e.saldo)return m.showToast(a("actualiza_tarjeta"),"long");tt(`/app/${e.numero}`)},F=async e=>{j.value=a("adding_tarjeta");const l=e.currentTarget;if(!l.checkValidity())return l.classList.add("was-validated");C("add-dialog"),$("progress-dialog");const{tarjeta:n,error:p,error_key:d}=await T.getTarjetaAPI(_.value.numero);if(n&&!p){if(n.nombre=_.value.nombre,n.fecha_added=new Date().toISOString().replace("T"," ").replace("Z",""),await r.tarjetaExists(n.numero))await m.showToast(`${a("existe_tarjeta")}: ${n.numero}`);else{const{error:g,error_key:M}=c.isGuest?{error:!1}:await T.addTarjeta({nombre:n.nombre,numero:n.numero,email:c.user.email,token:c.user.token});await r.insertTarjeta(n)>0&&!g?(await r.insertMovimientos(n),await m.showToast(`${a("tarjeta_added")}: ${n.numero}`)):await m.showToast(a(M)),h.value=await r.getTarjetas()}_.reset()}else await m.showToast(a(d||"error"),"long");await w(.5),C("progress-dialog"),l.classList.remove("was-validated")},E=async(e,l)=>{e.stopPropagation(),j.value=a("actualizando_tarjeta"),$("progress-dialog");const{tarjeta:n,error:p,error_key:d}=await T.getTarjetaAPI(l,!0);n&&!p?await r.updateTarjeta(n)>0&&(await r.deleteMovimientos(l),await r.insertMovimientos(n),await m.showToast(`${a("tarjeta_actualizada")}: ${n.numero}`),h.value=await r.getTarjetas()):await m.showToast(a(d||"error"),"long"),await w(.5),C("progress-dialog")};return Z(async()=>{if(!c.exists||(h.value=await r.getTarjetas(),h.value.length||c.user.updated||c.isGuest))return;j.value=a("adding_tarjetas"),await w(.5),$("progress-dialog");const{email:e,token:l}=c.user,{error:n,error_key:p,tarjetas:d}=await T.getTarjetas({email:e,token:l})||[];let i=[];n&&await m.showToast(a(p),"long"),d&&(A.value=d.length,I.value?i=d||[]:i=await T.getDetallesTarjetas(d)||[]);for(const y of i)await r.insertTarjeta(y)>0&&!I.value&&await r.insertMovimientos(y);const g=await r.getTarjetas(),M=g.entries();for(const[y,D]of M){if(h.value.push(D),await m.showToast(`${a("tarjeta_added")}: ${D.numero}`),g.length-1===y)break;await w(.5)}await c.setUpdated(),await w(.5),C("progress-dialog"),I.value&&(await w(.5),$("limit-dialog"))}),(e,l)=>{const n=N,p=G,d=ut;return b(),f("section",null,[v(X,{name:"tab"},{default:P(()=>[(b(!0),f(H,null,J(s(h),i=>(b(),f("div",{key:i.numero,class:"bg-body-tertiary border rounded d-flex p-2 mb-2 shadow",role:"button",onClick:g=>B(i)},[t("div",_t,[t("h4",pt,[t("b",null,o(i.nombre),1)]),t("div",gt,[t("p",bt,[t("b",null,o(("t"in e?e.t:s(a))("numero"))+": "+o(i.numero),1)]),v(K,{name:"fade",mode:"out-in"},{default:P(()=>[i.saldo?(b(),f("div",ft,[t("p",wt,o(("t"in e?e.t:s(a))("estado"))+": "+o(i.estado),1),t("p",vt,o(("t"in e?e.t:s(a))("tipo"))+": "+o(i.tipo),1),t("p",yt,o(("t"in e?e.t:s(a))("fecha"))+": "+o(i.fecha),1),t("h3",Tt,[t("b",null,o(("t"in e?e.t:s(a))("saldo"))+": B/. "+o(i.saldo),1)])])):(b(),f("div",jt,l[2]||(l[2]=[t("p",{class:"placeholder-glow m-0"},[t("span",{class:"placeholder col-6"})],-1),t("p",{class:"placeholder-glow m-0"},[t("span",{class:"placeholder col-5"})],-1),t("p",{class:"placeholder-glow m-0"},[t("span",{class:"placeholder col-7"})],-1),t("h3",{class:"placeholder-glow"},[t("span",{class:"placeholder col-6"})],-1)])))]),_:2},1024)])]),t("div",kt,[t("div",$t,[t("img",{class:"img-fluid rounded shadow-sm",src:`/images/${("getCardImage"in e?e.getCardImage:s(W))(i.tipo)}`,width:L.width,height:L.height},null,8,Ct)]),t("div",It,[t("button",{class:"btn btn-primary btn-sm",role:"button",onClick:g=>E(g,i.numero)},[v(n,{name:"refresh",size:"md"})],8,Mt)])])],8,ht))),128))]),_:1}),s(h).length?(b(),f("div",Dt,[t("p",At,[t("small",null,o(("t"in e?e.t:s(a))("tarjetas_note")),1)])])):Y("",!0),t("div",Lt,[t("button",Pt,[v(n,{name:"plus",size:"lg"})])]),t("div",zt,[t("div",St,[t("div",Vt,[t("div",Bt,[t("h1",Ft,[t("strong",null,o(("t"in e?e.t:s(a))("add_tarjeta")),1)])]),t("div",Et,[t("form",{novalidate:"",onSubmit:x(F,["prevent"])},[t("div",Nt,[z(t("input",{"onUpdate:modelValue":l[0]||(l[0]=i=>s(_).nombre=i),class:"form-control",type:"text",placeholder:("t"in e?e.t:s(a))("nombre"),required:""},null,8,Gt),[[S,s(_).nombre,void 0,{trim:!0}]]),t("label",null,o(("t"in e?e.t:s(a))("nombre")),1),t("div",Ot,o(("t"in e?e.t:s(a))("obligatorio")),1)]),t("div",Ut,[z(t("input",{"onUpdate:modelValue":l[1]||(l[1]=i=>s(_).numero=i),class:"form-control",type:"number",pattern:"[0-9]",placeholder:("t"in e?e.t:s(a))("numero_tarjeta"),required:""},null,8,qt),[[S,s(_).numero]]),t("label",null,o(("t"in e?e.t:s(a))("numero_tarjeta")),1),t("div",Rt,o(("t"in e?e.t:s(a))("error_tarjeta")),1)]),t("div",Qt,[t("button",Zt,o(("t"in e?e.t:s(a))("cancel")),1),t("button",Ht,o(("t"in e?e.t:s(a))("add")),1)])],32)])])])]),v(p,{message:s(j)},null,8,["message"]),v(d)])}}});export{Yt as default};
