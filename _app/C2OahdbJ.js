import{_ as C}from"./BkkCoIVg.js";import{_ as L}from"./jBsVCTT5.js";import{_ as A,o as b,c as w,a as e,t as a,i,e as s,L as I,b as _,w as M,F as D,r as z,j as P,M as F,p as V,l as B,m as $,v as k,A as h,D as d,g,s as j,f,C as u,h as y}from"./CsRaf_uk.js";import"./CQXJA_ZT.js";const S={},E={id:"limit-dialog",class:"modal fade",tabindex:"-1","aria-labelledby":"progress-dialog-label","aria-hidden":"true","data-bs-backdrop":"static"},N={class:"modal-dialog modal-dialog-centered"},G={class:"modal-content"},U={class:"modal-header"},q={id:"progress-dialog-label",class:"modal-title text-primary-emphasis"},O={class:"modal-body"},R={class:"m-0"},Z={class:"modal-footer"},H={class:"btn btn-primary w-100",type:"button","data-bs-dismiss":"modal"};function J(r,t){return b(),w("div",E,[e("div",N,[e("div",G,[e("div",U,[e("h5",q,[e("strong",null,a(("t"in r?r.t:i(s))("limit_tittle")),1)])]),e("div",O,[e("p",R,a(("t"in r?r.t:i(s))("limit_message")),1)]),e("div",Z,[e("button",H,a(("t"in r?r.t:i(s))("entendido")),1)])])])])}const K=A(S,[["render",J]]),Q=["onClick"],W={class:"flex-grow-1"},X={class:"text-primary-emphasis m-0"},Y={class:"info mx-2 small"},x={class:"m-0"},tt={class:"m-0"},et={class:"m-0"},st={class:"m-0"},at={class:"text-nowrap"},ot={class:"actions d-flex flex-column"},it={class:"image mb-2 mt-2"},rt=["src","width","height"],nt={class:"d-grid"},dt=["onClick"],lt={key:0,class:"text-center mt-3"},mt={class:"small m-0"},ct={class:"position-fixed bottom-0 end-0 m-3"},ht={class:"btn btn-primary rounded-circle p-1 shadow",role:"button","data-bs-toggle":"modal","data-bs-target":"#add-dialog"},ut={id:"add-dialog",class:"modal fade",tabindex:"-1","aria-labelledby":"add-dialog-label","aria-hidden":"true","data-bs-backdrop":"static"},gt={class:"modal-dialog modal-dialog-centered"},pt={class:"modal-content"},_t={class:"modal-header"},ft={id:"add-dialog-label",class:"modal-title fs-5 text-primary-emphasis"},bt={class:"modal-body text-center"},wt={class:"mb-3 position-relative form-floating"},vt=["placeholder"],jt={class:"invalid-tooltip"},yt={class:"mb-3 position-relative form-floating"},Tt=["placeholder"],$t={class:"invalid-tooltip"},kt={class:"d-flex justify-content-end"},Ct={class:"btn btn-danger me-2",type:"button","data-bs-dismiss":"modal"},Lt={class:"btn btn-primary",type:"submit",role:"button"},At={name:"AppPage",data(){return{tarjetas:[],size:{width:100,height:63},fetched:0,fetchLimit:4,form:{numero:"",nombre:""},progress:""}},computed:{isFetchLimited(){return this.fetched>this.fetchLimit}},async mounted(){if(h().exists&&(this.tarjetas=await d.getTarjetas(),!h().user.updated&&!this.tarjetas.length&&!h().isGuest)){this.progress=s("adding_tarjetas"),await g(.5),j("progress-dialog");const{email:r,token:t}=h().user,{error:n,error_key:m,tarjetas:l}=await f.getTarjetas({email:r,token:t})||[];let c=[];n&&await u.showToast(s(m),"long"),l&&(this.fetched=l.length,this.isFetchLimited?c=l||[]:c=await f.getDetallesTarjetas(l)||[]);for(const v of c)await d.insertTarjeta(v)>0&&!this.isFetchLimited&&await d.insertMovimientos(v);const o=await d.getTarjetas(),p=o.entries();for(const[v,T]of p){if(this.tarjetas.push(T),await u.showToast(`${s("tarjeta_added")}: ${T.numero}`),o.length-1===v)break;await g(.5)}await h().setUpdated(),await g(.5),y("progress-dialog"),this.isFetchLimited&&(await g(.5),j("limit-dialog"))}},methods:{async addTarjeta(){this.progress=s("adding_tarjeta");const r=this.$refs.add;if(r.checkValidity()){y("add-dialog"),j("progress-dialog");const{tarjeta:t,error:n,error_key:m}=await f.getTarjetaAPI(this.form.numero);if(t&&!n){if(t.nombre=String(this.form.nombre).trim(),t.fecha_added=new Date().toISOString().replace("T"," ").replace("Z",""),await d.tarjetaExists(Number(t.numero)))await u.showToast(`${s("existe_tarjeta")}: ${t.numero}`);else{const{error:c,error_key:o}=h().isGuest?{error:!1}:await f.addTarjeta({nombre:t.nombre,numero:t.numero,email:h().user.email,token:h().user.token});await d.insertTarjeta(t)>0&&!c?(await d.insertMovimientos(t),await u.showToast(`${s("tarjeta_added")}: ${t.numero}`)):await u.showToast(s(o)),this.tarjetas=await d.getTarjetas()}this.form={numero:"",nombre:""}}else await u.showToast(s(m),"long");await g(.5),y("progress-dialog"),r.classList.remove("was-validated")}else r.classList.add("was-validated")},openCard(r){this.$router.push(`${r}`)},async updateTarjeta(r,t){r.stopPropagation(),this.progress=s("actualizando_tarjeta"),j("progress-dialog");const{tarjeta:n,error:m,error_key:l}=await f.getTarjetaAPI(t,!0);n&&!m?await d.updateTarjeta(n)>0&&(await d.deleteMovimientos(t),await d.insertMovimientos(n),await u.showToast(`${s("tarjeta_actualizada")}: ${n.numero}`),this.tarjetas=await d.getTarjetas()):await u.showToast(s(l),"long"),await g(.5),y("progress-dialog")}}},Pt=I({...At,setup(r){return(t,n)=>{const m=C,l=L,c=K;return b(),w("section",null,[_(F,{name:"tab"},{default:M(()=>[(b(!0),w(D,null,z(t.tarjetas,o=>(b(),w("div",{key:o.numero,class:"bg-body-tertiary border rounded d-flex p-2 mb-2 shadow",role:"button",onClick:p=>t.openCard(o.numero)},[e("div",W,[e("h4",X,[e("b",null,a(o.nombre),1)]),e("div",Y,[e("p",x,a(("t"in t?t.t:i(s))("numero"))+": "+a(o.numero),1),e("p",tt,a(("t"in t?t.t:i(s))("estado"))+": "+a(o.estado),1),e("p",et,a(("t"in t?t.t:i(s))("tipo"))+": "+a(o.tipo),1),e("p",st,a(("t"in t?t.t:i(s))("fecha"))+": "+a(o.fecha),1),e("h3",at,[e("b",null,a(("t"in t?t.t:i(s))("saldo"))+": B/. "+a(o.saldo),1)])])]),e("div",ot,[e("div",it,[e("img",{class:"img-fluid rounded shadow-sm",src:`/images/${("getCardImage"in t?t.getCardImage:i(P))(o.tipo)}`,width:t.size.width,height:t.size.height},null,8,rt)]),e("div",nt,[e("button",{class:"btn btn-primary btn-sm",role:"button",onClick:p=>t.updateTarjeta(p,o.numero)},[_(m,{name:"refresh",size:"md"})],8,dt)])])],8,Q))),128))]),_:1}),t.tarjetas.length?(b(),w("div",lt,[e("p",mt,[e("small",null,a(("t"in t?t.t:i(s))("tarjetas_note")),1)])])):V("",!0),e("div",ct,[e("button",ht,[_(m,{name:"plus",size:"lg"})])]),e("div",ut,[e("div",gt,[e("div",pt,[e("div",_t,[e("h1",ft,[e("strong",null,a(("t"in t?t.t:i(s))("add_tarjeta")),1)])]),e("div",bt,[e("form",{ref:"add",novalidate:"",onSubmit:n[2]||(n[2]=B(o=>t.addTarjeta(),["prevent"]))},[e("div",wt,[$(e("input",{"onUpdate:modelValue":n[0]||(n[0]=o=>t.form.nombre=o),class:"form-control",type:"text",placeholder:("t"in t?t.t:i(s))("nombre"),required:""},null,8,vt),[[k,t.form.nombre]]),e("label",null,a(("t"in t?t.t:i(s))("nombre")),1),e("div",jt,a(("t"in t?t.t:i(s))("obligatorio")),1)]),e("div",yt,[$(e("input",{"onUpdate:modelValue":n[1]||(n[1]=o=>t.form.numero=o),class:"form-control",type:"number",pattern:"[0-9]",placeholder:("t"in t?t.t:i(s))("numero_tarjeta"),required:""},null,8,Tt),[[k,t.form.numero]]),e("label",null,a(("t"in t?t.t:i(s))("numero_tarjeta")),1),e("div",$t,a(("t"in t?t.t:i(s))("error_tarjeta")),1)]),e("div",kt,[e("button",Ct,a(("t"in t?t.t:i(s))("cancel")),1),e("button",Lt,a(("t"in t?t.t:i(s))("add")),1)])],544)])])])]),_(l,{message:t.progress},null,8,["message"]),_(c)])}}});export{Pt as default};
