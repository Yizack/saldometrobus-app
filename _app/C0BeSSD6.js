import{_ as E}from"./C8bLN4Xt.js";import{_ as N}from"./TvgfZJk6.js";import{_ as O,o as b,c as f,a as t,t as o,i as s,e,K as G,A as U,L as k,M as q,N as R,O as K,D as r,g as v,s as $,f as T,C as m,h as C,b as y,w as A,F as Q,r as Z,T as H,j as J,Q as W,p as X,l as Y,m as L,v as P,R as x}from"./DIlFzhNM.js";import"./BdIsnQkU.js";const tt={},at={id:"limit-dialog",class:"modal fade",tabindex:"-1","aria-labelledby":"progress-dialog-label","aria-hidden":"true","data-bs-backdrop":"static"},et={class:"modal-dialog modal-dialog-centered"},st={class:"modal-content"},ot={class:"modal-header"},it={id:"progress-dialog-label",class:"modal-title text-primary-emphasis"},nt={class:"modal-body"},lt={class:"m-0"},rt={class:"modal-footer"},dt={class:"btn btn-primary w-100",type:"button","data-bs-dismiss":"modal"};function ct(h,c){return b(),f("div",at,[t("div",et,[t("div",st,[t("div",ot,[t("h5",it,[t("strong",null,o(("t"in h?h.t:s(e))("limit_tittle")),1)])]),t("div",nt,[t("p",lt,o(("t"in h?h.t:s(e))("limit_message")),1)]),t("div",rt,[t("button",dt,o(("t"in h?h.t:s(e))("entendido")),1)])])])])}const mt=Object.assign(O(tt,[["render",ct]]),{__name:"LimitDialog"}),ut=["onClick"],ht={class:"flex-grow-1"},_t={class:"text-primary-emphasis m-0"},pt={class:"info mx-2 small"},gt={class:"m-0"},bt={key:0},ft={class:"m-0"},wt={class:"m-0"},vt={class:"m-0"},yt={class:"text-nowrap"},Tt={key:1},jt={class:"actions d-flex flex-column"},kt={class:"image mb-2 mt-2"},$t=["src","width","height"],Ct={class:"d-grid"},Dt=["onClick"],It={key:0,class:"text-center mt-3"},Mt={class:"small m-0"},At={class:"position-fixed bottom-0 end-0 m-3"},Lt={class:"btn btn-primary rounded-circle p-1 shadow",role:"button","data-bs-toggle":"modal","data-bs-target":"#add-dialog"},Pt={id:"add-dialog",class:"modal fade",tabindex:"-1","aria-labelledby":"add-dialog-label","aria-hidden":"true","data-bs-backdrop":"static"},zt={class:"modal-dialog modal-dialog-centered"},Vt={class:"modal-content"},Bt={class:"modal-header"},Ft={id:"add-dialog-label",class:"modal-title fs-5 text-primary-emphasis"},St={class:"modal-body text-center"},Et={class:"mb-3 position-relative form-floating"},Nt=["placeholder"],Ot={class:"invalid-tooltip"},Gt={class:"mb-3 position-relative form-floating"},Ut=["placeholder"],qt={class:"invalid-tooltip"},Rt={class:"d-flex justify-content-end"},Kt={class:"btn btn-danger me-2",type:"button","data-bs-dismiss":"modal"},Qt={class:"btn btn-primary",type:"submit",role:"button"},Xt=G({__name:"index",setup(h){const c=U(),_=k([]),I=k(0),z=k(4),j=k(""),p=q({numero:"",nombre:""}),M={width:100,height:63},D=R(()=>I.value>z.value),V=a=>{if(!a.saldo)return m.showToast(e("actualiza_tarjeta"),"long");x(`/app/${a.numero}`)},B=async a=>{j.value=e("adding_tarjeta");const l=a.currentTarget;if(!l.checkValidity())return l.classList.add("was-validated");C("add-dialog"),$("progress-dialog");const{tarjeta:n,error:g,error_key:d}=await T.getTarjetaAPI(p.value.numero);if(n&&!g){if(n.nombre=p.value.nombre,n.fecha_added=new Date().toISOString().replace("T"," ").replace("Z",""),await r.tarjetaExists(n.numero))await m.showToast(`${e("existe_tarjeta")}: ${n.numero}`);else{const{error:w,error_key:u}=c.isGuest?{error:!1}:await T.addTarjeta({nombre:n.nombre,numero:n.numero,email:c.user.email,token:c.user.token});await r.insertTarjeta(n)>0&&!w?(await r.insertMovimientos(n),await m.showToast(`${e("tarjeta_added")}: ${n.numero}`)):await m.showToast(e(u)),_.value=await r.getTarjetas()}p.reset()}else await m.showToast(e(d||"error"),"long");await v(.5),C("progress-dialog"),l.classList.remove("was-validated")},F=async(a,l)=>{a.stopPropagation(),j.value=e("actualizando_tarjeta"),$("progress-dialog");const{tarjeta:n,error:g,error_key:d}=await T.getTarjetaAPI(l,!0);n&&!g?await r.updateTarjeta(n)>0&&(await r.deleteMovimientos(l),await r.insertMovimientos(n),await m.showToast(`${e("tarjeta_actualizada")}: ${n.numero}`),_.value=await r.getTarjetas()):await m.showToast(e(d||"error"),"long"),await v(.5),C("progress-dialog")};return K(async()=>{if(!c.exists||(_.value=await r.getTarjetas(),_.value.length||c.user.updated||c.isGuest))return;j.value=e("adding_tarjetas"),await v(.5),$("progress-dialog");const{email:a,token:l}=c.user,{error:n,error_key:g,tarjetas:d}=await T.getTarjetas({email:a,token:l})||[];let i=[];n&&await m.showToast(e(g),"long"),d&&(I.value=d.length,D.value?i=d||[]:i=await T.getDetallesTarjetas(d)||[]);for(const u of i)await r.insertTarjeta(u)>0&&!D.value&&await r.insertMovimientos(u);const w=await r.getTarjetas();for(const u of w)_.value.push(u),u.saldo&&await m.showToast(`${e("tarjeta_added")}: ${u.numero}`),await v(.5);await c.setUpdated(),await v(.5),C("progress-dialog"),D.value&&(await v(.5),$("limit-dialog"))}),(a,l)=>{const n=E,g=N,d=mt;return b(),f("section",null,[y(W,{name:"tab"},{default:A(()=>[(b(!0),f(Q,null,Z(s(_),i=>(b(),f("div",{key:i.numero,class:"bg-body-tertiary border rounded d-flex p-2 mb-2 shadow",role:"button",onClick:w=>V(i)},[t("div",ht,[t("h4",_t,[t("b",null,o(i.nombre),1)]),t("div",pt,[t("p",gt,[t("b",null,o(("t"in a?a.t:s(e))("numero"))+": "+o(i.numero),1)]),y(H,{name:"fade",mode:"out-in"},{default:A(()=>[i.saldo?(b(),f("div",bt,[t("p",ft,o(("t"in a?a.t:s(e))("estado"))+": "+o(i.estado),1),t("p",wt,o(("t"in a?a.t:s(e))("tipo"))+": "+o(i.tipo),1),t("p",vt,o(("t"in a?a.t:s(e))("fecha"))+": "+o(i.fecha),1),t("h3",yt,[t("b",null,o(("t"in a?a.t:s(e))("saldo"))+": B/. "+o(i.saldo),1)])])):(b(),f("div",Tt,l[2]||(l[2]=[t("p",{class:"placeholder-glow m-0"},[t("span",{class:"placeholder col-6"})],-1),t("p",{class:"placeholder-glow m-0"},[t("span",{class:"placeholder col-5"})],-1),t("p",{class:"placeholder-glow m-0"},[t("span",{class:"placeholder col-7"})],-1),t("h3",{class:"placeholder-glow"},[t("span",{class:"placeholder col-6"})],-1)])))]),_:2},1024)])]),t("div",jt,[t("div",kt,[t("img",{class:"img-fluid rounded shadow-sm",src:`/images/${("getCardImage"in a?a.getCardImage:s(J))(i.tipo)}`,width:M.width,height:M.height},null,8,$t)]),t("div",Ct,[t("button",{class:"btn btn-primary btn-sm",role:"button",onClick:w=>F(w,i.numero)},[y(n,{name:"refresh",size:"md"})],8,Dt)])])],8,ut))),128))]),_:1}),s(_).length?(b(),f("div",It,[t("p",Mt,[t("small",null,o(("t"in a?a.t:s(e))("tarjetas_note")),1)])])):X("",!0),t("div",At,[t("button",Lt,[y(n,{name:"plus",size:"lg"})])]),t("div",Pt,[t("div",zt,[t("div",Vt,[t("div",Bt,[t("h1",Ft,[t("strong",null,o(("t"in a?a.t:s(e))("add_tarjeta")),1)])]),t("div",St,[t("form",{novalidate:"",onSubmit:Y(B,["prevent"])},[t("div",Et,[L(t("input",{"onUpdate:modelValue":l[0]||(l[0]=i=>s(p).nombre=i),class:"form-control",type:"text",placeholder:("t"in a?a.t:s(e))("nombre"),required:""},null,8,Nt),[[P,s(p).nombre,void 0,{trim:!0}]]),t("label",null,o(("t"in a?a.t:s(e))("nombre")),1),t("div",Ot,o(("t"in a?a.t:s(e))("obligatorio")),1)]),t("div",Gt,[L(t("input",{"onUpdate:modelValue":l[1]||(l[1]=i=>s(p).numero=i),class:"form-control",type:"number",pattern:"[0-9]",placeholder:("t"in a?a.t:s(e))("numero_tarjeta"),required:""},null,8,Ut),[[P,s(p).numero]]),t("label",null,o(("t"in a?a.t:s(e))("numero_tarjeta")),1),t("div",qt,o(("t"in a?a.t:s(e))("error_tarjeta")),1)]),t("div",Rt,[t("button",Kt,o(("t"in a?a.t:s(e))("cancel")),1),t("button",Qt,o(("t"in a?a.t:s(e))("add")),1)])],32)])])])]),y(g,{message:s(j)},null,8,["message"]),y(d)])}}});export{Xt as default};
