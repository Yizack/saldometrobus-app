import{_ as z}from"./Icon.a9a7f38d.js";import{_ as A}from"./ProgressDialog.4683eb02.js";import{f as p,F as C,r as M,i as s,j as o,u as r,H as D,p as f,w as P,m as v,v as T,A as m,D as d,t as e,e as g,s as j,b,C as u,h as _,o as c}from"./entry.851f850c.js";import"./nuxt-icon.vue.ce7c238d.js";const I=""+globalThis.__publicAssetsURL("images/rapipass.webp"),L=""+globalThis.__publicAssetsURL("images/metro_metrobus.webp"),U=""+globalThis.__publicAssetsURL("images/metrobus.webp"),V=["onClick"],B={class:"flex-grow-1"},S={class:"text-primary-emphasis m-0"},E={class:"info mx-2 small"},R={class:"m-0"},N={class:"m-0"},O={class:"m-0"},q={class:"m-0"},F={class:"actions"},G={class:"image"},H=["width","height"],Z=["width","height"],J=["width","height"],K={class:"d-grid gap-2"},Q=["onClick"],W={key:0,class:"text-center mt-3"},X={class:"small m-0"},Y={class:"position-fixed bottom-0 end-0 m-3"},x={class:"btn btn-primary rounded-circle p-1 shadow",role:"button","data-bs-toggle":"modal","data-bs-target":"#add-dialog"},tt={id:"add-dialog",class:"modal fade",tabindex:"-1","aria-labelledby":"add-dialog-label","aria-hidden":"true","data-bs-backdrop":"static"},st={class:"modal-dialog modal-dialog-centered"},et={class:"modal-content"},at={class:"modal-header"},ot={id:"add-dialog-label",class:"modal-title fs-5 text-primary-emphasis"},it={class:"modal-body text-center"},rt={class:"mb-3 position-relative form-floating"},nt=["placeholder"],dt={class:"invalid-tooltip"},lt={class:"mb-3 position-relative form-floating"},mt=["placeholder"],ht={class:"invalid-tooltip"},pt={class:"d-flex justify-content-end"},ut={class:"btn btn-danger me-2",type:"button","data-bs-dismiss":"modal"},ct={class:"btn btn-primary",type:"submit",role:"button"},gt={name:"AppPage",data(){return{tarjetas:[],size:100,form:{numero:"",nombre:""},progress:""}},async mounted(){if(m().exists&&(this.tarjetas=await d.getTarjetas(),!m().user.updated&&!this.tarjetas.length&&!m().isGuest)){this.progress=e("adding_tarjetas"),await g(.5),j("progress-dialog");const{email:l,token:t}=m().user,n=await b.getDetallesTarjetas({email:l,token:t})||[];for(const a of n){const{changes:h}=await d.insertTarjeta(a);await d.insertMovimientos(a),h>0&&await u.showToast(`${e("tarjeta_added")}: ${a.numero}`)}this.tarjetas=await d.getTarjetas(),await m().setUpdated(),await g(.5),_("progress-dialog")}},methods:{async addTarjeta(){this.progress=e("adding_tarjeta");const l=this.$refs.add;if(l.checkValidity()){_("add-dialog"),j("progress-dialog");const{nombre:t,numero:n}=this.form,{tarjeta:a,error:h,error_key:i}=await b.getTarjetaAPI(n);if(a&&!h){if(a.nombre=String(t).trim(),a.fecha_added=new Date().toISOString().replace("T"," ").replace("Z",""),await d.tarjetaExists(a.numero))await u.showToast(`${e("existe_tarjeta")}: ${a.numero}`);else{const{error:y,error_key:k}=m().isGuest?{error:!1}:await b.addTarjeta({nombre:a.nombre,numero:a.numero,email:m().user.email,token:m().user.token}),{changes:$}=await d.insertTarjeta(a);$>0&&!y?(await d.insertMovimientos(a),await u.showToast(`${e("tarjeta_added")}: ${a.numero}`)):await u.showToast(e(k)),this.tarjetas=await d.getTarjetas()}this.form={numero:"",nombre:""}}else await u.showToast(e(i),"long");await g(.5),_("progress-dialog"),l.classList.remove("was-validated")}else l.classList.add("was-validated")},openCard(l){this.$router.push(`${l}`)},async updateTarjeta(l){this.progress=e("actualizando_tarjeta"),j("progress-dialog");const{tarjeta:t,error:n,error_key:a}=await b.getTarjetaAPI(l);if(t&&!n){const{changes:h}=await d.updateTarjeta(t);h>0&&(await d.deleteMovimientos(l),await d.insertMovimientos(t),await u.showToast(`${e("tarjeta_actualizada")}: ${t.numero}`),this.tarjetas=await d.getTarjetas())}else await u.showToast(e(a),"long");await g(.5),_("progress-dialog")}}},jt=Object.assign(gt,{setup(l){return(t,n)=>{const a=z,h=A;return c(),p("section",null,[(c(!0),p(C,null,M(t.tarjetas,i=>(c(),p("div",{key:i.numero,class:"bg-body-tertiary border rounded d-flex p-2 mb-2 shadow",role:"button",onClick:w=>t.openCard(i.numero)},[s("div",B,[s("h4",S,[s("b",null,o(i.nombre),1)]),s("div",E,[s("p",R,o(("t"in t?t.t:r(e))("numero"))+": "+o(i.numero),1),s("p",N,o(("t"in t?t.t:r(e))("estado"))+": "+o(i.estado),1),s("p",O,o(("t"in t?t.t:r(e))("tipo"))+": "+o(i.tipo),1),s("p",q,o(("t"in t?t.t:r(e))("fecha"))+": "+o(i.fecha),1),s("h3",null,[s("b",null,o(("t"in t?t.t:r(e))("saldo"))+": B/. "+o(i.saldo),1)])])]),s("div",F,[s("div",G,[i.tipo===("t"in t?t.t:r(e))("tarjeta_rapipass")?(c(),p("img",{key:0,class:"img-fluid",src:I,width:t.size,height:t.size},null,8,H)):i.tipo===("t"in t?t.t:r(e))("tarjeta_normal")?(c(),p("img",{key:1,class:"img-fluid",src:L,width:t.size,height:t.size},null,8,Z)):(c(),p("img",{key:2,src:U,class:"img-fluid",width:t.size,height:t.size},null,8,J))]),s("div",K,[s("button",{class:"btn btn-primary btn-sm",role:"button",onClick:w=>{w.stopPropagation(),t.updateTarjeta(i.numero)}},[f(a,{name:"refresh",size:"md"})],8,Q)])])],8,V))),128)),t.tarjetas.length?(c(),p("div",W,[s("p",X,[s("small",null,o(("t"in t?t.t:r(e))("tarjetas_note")),1)])])):D("",!0),s("div",Y,[s("button",x,[f(a,{name:"plus",size:"lg"})])]),s("div",tt,[s("div",st,[s("div",et,[s("div",at,[s("h1",ot,o(("t"in t?t.t:r(e))("add_tarjeta")),1)]),s("div",it,[s("form",{ref:"add",novalidate:"",onSubmit:n[2]||(n[2]=P(i=>t.addTarjeta(),["prevent"]))},[s("div",rt,[v(s("input",{"onUpdate:modelValue":n[0]||(n[0]=i=>t.form.nombre=i),class:"form-control",type:"text",placeholder:("t"in t?t.t:r(e))("nombre"),required:""},null,8,nt),[[T,t.form.nombre]]),s("label",null,o(("t"in t?t.t:r(e))("nombre")),1),s("div",dt,o(("t"in t?t.t:r(e))("obligatorio")),1)]),s("div",lt,[v(s("input",{"onUpdate:modelValue":n[1]||(n[1]=i=>t.form.numero=i),class:"form-control",type:"number",pattern:"[0-9]",placeholder:("t"in t?t.t:r(e))("numero_tarjeta"),required:""},null,8,mt),[[T,t.form.numero]]),s("label",null,o(("t"in t?t.t:r(e))("numero_tarjeta")),1),s("div",ht,o(("t"in t?t.t:r(e))("error_tarjeta")),1)]),s("div",pt,[s("button",ut,o(("t"in t?t.t:r(e))("cancel")),1),s("button",ct,o(("t"in t?t.t:r(e))("add")),1)])],544)])])])]),f(h,{message:t.progress},null,8,["message"])])}}});export{jt as default};
