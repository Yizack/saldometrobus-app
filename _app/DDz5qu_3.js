import{_ as C}from"./BIS7AqKE.js";import{_ as L}from"./BM7ibM4u.js";import{_ as A,o as w,c as v,a as e,t as a,i,e as s,L as I,b as f,w as M,F as D,r as z,j as P,M as F,p as V,l as B,m as $,v as k,A as h,D as l,g as _,s as y,f as b,C as g,h as T}from"./C30pMtxJ.js";import"./DdnVlZdn.js";const S={},E={id:"limit-dialog",class:"modal fade",tabindex:"-1","aria-labelledby":"progress-dialog-label","aria-hidden":"true","data-bs-backdrop":"static"},G={class:"modal-dialog modal-dialog-centered"},N={class:"modal-content"},U={class:"modal-header"},q={id:"progress-dialog-label",class:"modal-title text-primary-emphasis"},O={class:"modal-body"},R={class:"m-0"},Z={class:"modal-footer"},H={class:"btn btn-primary w-100",type:"button","data-bs-dismiss":"modal"};function J(n,t){return w(),v("div",E,[e("div",G,[e("div",N,[e("div",U,[e("h5",q,[e("strong",null,a(("t"in n?n.t:i(s))("limit_tittle")),1)])]),e("div",O,[e("p",R,a(("t"in n?n.t:i(s))("limit_message")),1)]),e("div",Z,[e("button",H,a(("t"in n?n.t:i(s))("entendido")),1)])])])])}const K=A(S,[["render",J]]),Q=["onClick"],W={class:"flex-grow-1"},X={class:"text-primary-emphasis m-0"},Y={class:"info mx-2 small"},x={class:"m-0"},tt={class:"m-0"},et={class:"m-0"},st={class:"m-0"},at={class:"text-nowrap"},ot={class:"actions d-flex flex-column"},it={class:"image mb-2 mt-2"},nt=["src","width","height"],rt={class:"d-grid"},dt=["onClick"],lt={key:0,class:"text-center mt-3"},mt={class:"small m-0"},ct={class:"position-fixed bottom-0 end-0 m-3"},ht={class:"btn btn-primary rounded-circle p-1 shadow",role:"button","data-bs-toggle":"modal","data-bs-target":"#add-dialog"},gt={id:"add-dialog",class:"modal fade",tabindex:"-1","aria-labelledby":"add-dialog-label","aria-hidden":"true","data-bs-backdrop":"static"},pt={class:"modal-dialog modal-dialog-centered"},ut={class:"modal-content"},_t={class:"modal-header"},ft={id:"add-dialog-label",class:"modal-title fs-5 text-primary-emphasis"},bt={class:"modal-body text-center"},wt={class:"mb-3 position-relative form-floating"},vt=["placeholder"],jt={class:"invalid-tooltip"},yt={class:"mb-3 position-relative form-floating"},Tt=["placeholder"],$t={class:"invalid-tooltip"},kt={class:"d-flex justify-content-end"},Ct={class:"btn btn-danger me-2",type:"button","data-bs-dismiss":"modal"},Lt={class:"btn btn-primary",type:"submit",role:"button"},At={name:"AppPage",data(){return{tarjetas:[],size:{width:100,height:63},fetched:0,fetchLimit:4,form:{numero:"",nombre:""},progress:""}},computed:{isFetchLimited(){return this.fetched>this.fetchLimit}},async mounted(){if(h().exists&&(this.tarjetas=await l.getTarjetas(),!h().user.updated&&!this.tarjetas.length&&!h().isGuest)){this.progress=s("adding_tarjetas"),await _(.5),y("progress-dialog");const{email:n,token:t}=h().user,{error:d,error_key:r,tarjetas:m}=await b.getTarjetas({email:n,token:t})||[];let c=[];d&&await g.showToast(s(r),"long"),m&&(this.fetched=m.length,this.isFetchLimited?c=m||[]:c=await b.getDetallesTarjetas(m)||[]);for(const u of c)await l.insertTarjeta(u)>0&&!this.isFetchLimited&&await l.insertMovimientos(u);const o=await l.getTarjetas(),p=o.entries();for(const[u,j]of p){if(this.tarjetas.push(j),await g.showToast(`${s("tarjeta_added")}: ${j.numero}`),o.length-1===u)break;await _(.5)}await h().setUpdated(),await _(.5),T("progress-dialog"),this.isFetchLimited&&(await _(.5),y("limit-dialog"))}},methods:{async addTarjeta(){this.progress=s("adding_tarjeta");const n=this.$refs.add;if(n.checkValidity()){T("add-dialog"),y("progress-dialog");const{nombre:t,numero:d}=this.form,{tarjeta:r,error:m,error_key:c}=await b.getTarjetaAPI(d);if(r&&!m){if(r.nombre=String(t).trim(),r.fecha_added=new Date().toISOString().replace("T"," ").replace("Z",""),await l.tarjetaExists(r.numero))await g.showToast(`${s("existe_tarjeta")}: ${r.numero}`);else{const{error:p,error_key:u}=h().isGuest?{error:!1}:await b.addTarjeta({nombre:r.nombre,numero:r.numero,email:h().user.email,token:h().user.token});await l.insertTarjeta(r)>0&&!p?(await l.insertMovimientos(r),await g.showToast(`${s("tarjeta_added")}: ${r.numero}`)):await g.showToast(s(u)),this.tarjetas=await l.getTarjetas()}this.form={numero:"",nombre:""}}else await g.showToast(s(c),"long");await _(.5),T("progress-dialog"),n.classList.remove("was-validated")}else n.classList.add("was-validated")},openCard(n){this.$router.push(`${n}`)},async updateTarjeta(n,t){n.stopPropagation(),this.progress=s("actualizando_tarjeta"),y("progress-dialog");const{tarjeta:d,error:r,error_key:m}=await b.getTarjetaAPI(t);d&&!r?await l.updateTarjeta(d)>0&&(await l.deleteMovimientos(t),await l.insertMovimientos(d),await g.showToast(`${s("tarjeta_actualizada")}: ${d.numero}`),this.tarjetas=await l.getTarjetas()):await g.showToast(s(m),"long"),await _(.5),T("progress-dialog")}}},Pt=I({...At,setup(n){return(t,d)=>{const r=C,m=L,c=K;return w(),v("section",null,[f(F,{name:"tab"},{default:M(()=>[(w(!0),v(D,null,z(t.tarjetas,o=>(w(),v("div",{key:o.numero,class:"bg-body-tertiary border rounded d-flex p-2 mb-2 shadow",role:"button",onClick:p=>t.openCard(o.numero)},[e("div",W,[e("h4",X,[e("b",null,a(o.nombre),1)]),e("div",Y,[e("p",x,a(("t"in t?t.t:i(s))("numero"))+": "+a(o.numero),1),e("p",tt,a(("t"in t?t.t:i(s))("estado"))+": "+a(o.estado),1),e("p",et,a(("t"in t?t.t:i(s))("tipo"))+": "+a(o.tipo),1),e("p",st,a(("t"in t?t.t:i(s))("fecha"))+": "+a(o.fecha),1),e("h3",at,[e("b",null,a(("t"in t?t.t:i(s))("saldo"))+": B/. "+a(o.saldo),1)])])]),e("div",ot,[e("div",it,[e("img",{class:"img-fluid rounded shadow-sm",src:`/images/${("getCardImage"in t?t.getCardImage:i(P))(o.tipo)}`,width:t.size.width,height:t.size.height},null,8,nt)]),e("div",rt,[e("button",{class:"btn btn-primary btn-sm",role:"button",onClick:p=>t.updateTarjeta(p,o.numero)},[f(r,{name:"refresh",size:"md"})],8,dt)])])],8,Q))),128))]),_:1}),t.tarjetas.length?(w(),v("div",lt,[e("p",mt,[e("small",null,a(("t"in t?t.t:i(s))("tarjetas_note")),1)])])):V("",!0),e("div",ct,[e("button",ht,[f(r,{name:"plus",size:"lg"})])]),e("div",gt,[e("div",pt,[e("div",ut,[e("div",_t,[e("h1",ft,[e("strong",null,a(("t"in t?t.t:i(s))("add_tarjeta")),1)])]),e("div",bt,[e("form",{ref:"add",novalidate:"",onSubmit:d[2]||(d[2]=B(o=>t.addTarjeta(),["prevent"]))},[e("div",wt,[$(e("input",{"onUpdate:modelValue":d[0]||(d[0]=o=>t.form.nombre=o),class:"form-control",type:"text",placeholder:("t"in t?t.t:i(s))("nombre"),required:""},null,8,vt),[[k,t.form.nombre]]),e("label",null,a(("t"in t?t.t:i(s))("nombre")),1),e("div",jt,a(("t"in t?t.t:i(s))("obligatorio")),1)]),e("div",yt,[$(e("input",{"onUpdate:modelValue":d[1]||(d[1]=o=>t.form.numero=o),class:"form-control",type:"number",pattern:"[0-9]",placeholder:("t"in t?t.t:i(s))("numero_tarjeta"),required:""},null,8,Tt),[[k,t.form.numero]]),e("label",null,a(("t"in t?t.t:i(s))("numero_tarjeta")),1),e("div",$t,a(("t"in t?t.t:i(s))("error_tarjeta")),1)]),e("div",kt,[e("button",Ct,a(("t"in t?t.t:i(s))("cancel")),1),e("button",Lt,a(("t"in t?t.t:i(s))("add")),1)])],544)])])])]),f(m,{message:t.progress},null,8,["message"]),f(c)])}}});export{Pt as default};
