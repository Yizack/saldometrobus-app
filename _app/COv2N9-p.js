import F from"./DBOd63DP.js";import{_ as N}from"./RPdvtKHW.js";import{_ as O}from"./pBGypGOw.js";import{c as y,o as f,a as t,t as n,f as s,g as a,e as q,A as x,B as k,q as G,O as U,P as r,k as v,s as $,Q as T,C as _,l as C,b as w,E as R,w as M,R as Q,h as Z,i as B,v as P,M as H,N as J,I as K,T as W,S as X,n as Y}from"#entry";import{_ as tt}from"./DlAUqK2U.js";import{u as et}from"./BTPz0zLs.js";const at={},st={id:"limit-dialog",class:"modal fade",tabindex:"-1","aria-labelledby":"progress-dialog-label","aria-hidden":"true","data-bs-backdrop":"static"},ot={class:"modal-dialog modal-dialog-centered"},it={class:"modal-content"},nt={class:"modal-header"},lt={id:"progress-dialog-label",class:"modal-title text-primary-emphasis"},rt={class:"modal-body"},dt={class:"m-0"},ct={class:"modal-footer"},mt={class:"btn btn-primary w-100",type:"button","data-bs-dismiss":"modal"};function _t(u,m){return f(),y("div",st,[t("div",ot,[t("div",it,[t("div",nt,[t("h5",lt,[t("strong",null,n(("t"in u?u.t:s(a))("limit_tittle")),1)])]),t("div",rt,[t("p",dt,n(("t"in u?u.t:s(a))("limit_message")),1)]),t("div",ct,[t("button",mt,n(("t"in u?u.t:s(a))("entendido")),1)])])])])}const ut=Object.assign(tt(at,[["render",_t]]),{__name:"LimitDialog"}),ht={class:"d-flex"},pt={class:"flex-grow-1"},gt={class:"info mx-2 small"},bt={key:0},ft={class:"mb-1"},vt={class:"small fw-bold"},wt={class:"m-0"},yt={class:"mb-1"},Tt={class:"small fw-bold"},jt={class:"text-nowrap m-0"},kt={class:"text-primary border-primary border-start rounded ps-3 py-1 border-3"},$t={class:"small fw-bold"},Ct={class:"text-nowrap fw-bold h3 m-0"},It={key:1},Mt={class:"actions d-flex flex-column"},Dt={class:"image"},At=["src","width","height"],Bt={class:"bg-secondary-subtle rounded px-2 fw-bold text-body my-1 text-center"},Pt={class:"d-grid"},Lt=["onClick"],zt={key:0,class:"text-center mt-3"},St={class:"small m-0"},Vt={class:"position-fixed bottom-0 end-0 m-3"},Et={class:"btn btn-primary rounded-circle p-1 shadow",role:"button","data-bs-toggle":"modal","data-bs-target":"#add-dialog"},Ft={id:"add-dialog",class:"modal fade",tabindex:"-1","aria-labelledby":"add-dialog-label","aria-hidden":"true","data-bs-backdrop":"static"},Nt={class:"modal-dialog modal-dialog-centered"},Ot={class:"modal-content"},qt={class:"modal-header"},xt={id:"add-dialog-label",class:"modal-title fs-5 text-primary-emphasis"},Gt={class:"modal-body text-center"},Ut={class:"mb-3 position-relative form-floating"},Rt=["placeholder"],Qt={class:"invalid-tooltip"},Zt={class:"mb-3 position-relative form-floating"},Ht=["placeholder"],Jt={class:"invalid-tooltip"},Kt={class:"d-flex justify-content-end"},Wt={class:"btn btn-danger me-2",type:"button","data-bs-dismiss":"modal"},Xt={class:"btn btn-primary",type:"submit",role:"button"},ie=q({__name:"index",setup(u){const m=x(),h=k([]),D=k(0),L=k(4),j=k(""),p=et({numero:"",nombre:""}),A={width:100,height:63},I=G(()=>D.value>L.value),z=e=>{if(!e.saldo)return _.showToast(a("actualiza_tarjeta"),"long");Y(`/app/${e.numero}`)},S=async e=>{j.value=a("adding_tarjeta");const l=e.currentTarget;if(!l.checkValidity())return l.classList.add("was-validated");C("add-dialog"),$("progress-dialog");const{tarjeta:o,error:g,error_key:c}=await T.getTarjetaAPI(p.value.numero);if(o&&!g){if(o.nombre=p.value.nombre,o.fecha_added=new Date().toISOString().replace("T"," ").replace("Z",""),await r.tarjetaExists(o.numero))await _.showToast(`${a("existe_tarjeta")}: ${o.numero}`);else{const{error:i,error_key:d}=m.isGuest?{error:!1}:await T.addTarjeta({nombre:o.nombre,numero:o.numero,email:m.user.email,token:m.user.token});await r.insertTarjeta(o)>0&&!i?(await r.insertMovimientos(o),await _.showToast(`${a("tarjeta_added")}: ${o.numero}`)):await _.showToast(a(d)),h.value=await r.getTarjetas()}p.reset()}else await _.showToast(a(c||"error"),"long");await v(.5),C("progress-dialog"),l.classList.remove("was-validated")},V=async(e,l)=>{e.stopPropagation(),j.value=a("actualizando_tarjeta"),$("progress-dialog");const{tarjeta:o,error:g,error_key:c}=await T.getTarjetaAPI(l,!0);o&&!g?await r.updateTarjeta(o)>0&&(await r.deleteMovimientos(l),await r.insertMovimientos(o),await _.showToast(`${a("tarjeta_actualizada")}: ${o.numero}`),h.value=await r.getTarjetas()):await _.showToast(a(c||"error"),"long"),await v(.5),C("progress-dialog")};return U(async()=>{if(!m.exists||(h.value=await r.getTarjetas(),h.value.length||m.user.updated||m.isGuest))return;j.value=a("adding_tarjetas"),await v(.5),$("progress-dialog");const{email:e,token:l}=m.user,{error:o,error_key:g,tarjetas:c}=await T.getTarjetas({email:e,token:l})||[];let b=[];o&&await _.showToast(a(g),"long"),c&&(D.value=c.length,I.value?b=c||[]:b=await T.getDetallesTarjetas(c)||[]);for(const d of b)await r.insertTarjeta(d)>0&&!I.value&&await r.insertMovimientos(d);const i=await r.getTarjetas();for(const d of i)h.value.push(d),d.saldo&&await _.showToast(`${a("tarjeta_added")}: ${d.numero}`),await v(.5);await m.setUpdated(),await v(.5),C("progress-dialog"),I.value&&(await v(.5),$("limit-dialog"))}),(e,l)=>{const o=F,g=N,c=O,b=ut;return f(),y("section",null,[w(Q,{name:"tab"},{default:M(()=>[(f(!0),y(H,null,J(s(h),i=>(f(),K(g,{key:i.numero,title:i.nombre,p2:"",role:"button",onClick:d=>z(i)},{default:M(()=>[t("div",ht,[t("div",pt,[t("div",gt,[w(W,{name:"fade",mode:"out-in"},{default:M(()=>[i.saldo?(f(),y("div",bt,[t("div",ft,[t("div",vt,n(("t"in e?e.t:s(a))("tipo")),1),t("div",wt,n(i.tipo),1)]),t("div",yt,[t("div",Tt,n(("t"in e?e.t:s(a))("fecha")),1),t("div",jt,n(i.fecha),1)]),t("div",kt,[t("div",$t,n(("t"in e?e.t:s(a))("saldo")),1),t("div",Ct,"B/. "+n(i.saldo),1)])])):(f(),y("div",It,[...l[2]||(l[2]=[t("p",{class:"placeholder-glow m-0"},[t("span",{class:"placeholder col-6"})],-1),t("p",{class:"placeholder-glow m-0"},[t("span",{class:"placeholder col-5"})],-1),t("p",{class:"placeholder-glow m-0"},[t("span",{class:"placeholder col-7"})],-1),t("h3",{class:"placeholder-glow"},[t("span",{class:"placeholder col-6"})],-1)])]))]),_:2},1024)])]),t("div",Mt,[t("div",Dt,[t("img",{class:"img-fluid rounded shadow-sm border",src:`/images/${("getCardImage"in e?e.getCardImage:s(X))(i.tipo)}`,width:A.width,height:A.height},null,8,At)]),t("p",Bt,n(i.numero),1),t("div",Pt,[t("button",{class:"btn btn-secondary btn-sm py-2",role:"button",onClick:d=>V(d,i.numero)},[w(o,{name:"refresh",size:"1.3rem"})],8,Lt)])])])]),_:2},1032,["title","onClick"]))),128))]),_:1}),s(h).length?(f(),y("div",zt,[t("p",St,[t("small",null,n(("t"in e?e.t:s(a))("tarjetas_note")),1)])])):R("",!0),t("div",Vt,[t("button",Et,[w(o,{name:"plus",size:"3rem"})])]),t("div",Ft,[t("div",Nt,[t("div",Ot,[t("div",qt,[t("h1",xt,[t("strong",null,n(("t"in e?e.t:s(a))("add_tarjeta")),1)])]),t("div",Gt,[t("form",{novalidate:"",onSubmit:Z(S,["prevent"])},[t("div",Ut,[B(t("input",{"onUpdate:modelValue":l[0]||(l[0]=i=>s(p).nombre=i),class:"form-control",type:"text",placeholder:("t"in e?e.t:s(a))("nombre"),required:""},null,8,Rt),[[P,s(p).nombre,void 0,{trim:!0}]]),t("label",null,n(("t"in e?e.t:s(a))("nombre")),1),t("div",Qt,n(("t"in e?e.t:s(a))("obligatorio")),1)]),t("div",Zt,[B(t("input",{"onUpdate:modelValue":l[1]||(l[1]=i=>s(p).numero=i),class:"form-control",type:"number",pattern:"[0-9]",placeholder:("t"in e?e.t:s(a))("numero_tarjeta"),required:""},null,8,Ht),[[P,s(p).numero]]),t("label",null,n(("t"in e?e.t:s(a))("numero_tarjeta")),1),t("div",Jt,n(("t"in e?e.t:s(a))("error_tarjeta")),1)]),t("div",Kt,[t("button",Wt,n(("t"in e?e.t:s(a))("cancel")),1),t("button",Xt,n(("t"in e?e.t:s(a))("add")),1)])],32)])])])]),w(c,{message:s(j)},null,8,["message"]),w(b)])}}});export{ie as default};
