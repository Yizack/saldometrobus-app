import{_ as P}from"./ProgressDialog.389456b4.js";import{C as F,j as T,i as A,t as a,P as V,k as G,l as q,m as x,p as U,q as H,o as m,f as _,r as e,s as i,u as n,F as D,v as I,w as B,x as C,y as L,A as w,z as M,D as O,B as $,E as N,h as J,G as K,H as W,I as Z,J as E,K as Q,T as X,c as z,L as Y}from"./entry.182ace67.js";class R{constructor(s,o){this.ctx=s,this.dataset=o}render(s){const{reduce:o,color:b,color_area:d,title:u,monotone:r,tension:l,stepped:g,subtitle:v,text_color:y,tick_color:c}=s,f=o?this.dataset.reduce((h,p)=>{const k=h.findIndex(S=>S.x===p.x);return k<0?h.push({x:p.x,y:p.y}):h[k].y+=p.y,h},[]):this.dataset.reduce((h,p)=>{const k=h.findIndex(S=>S.x===p.x);return k<0?h.push({x:p.x,y:p.y}):h[k].y=p.y,h},[]),j=o?f.reduce((h,p)=>h+p.y,0):f[f.length-1].y;return new F(this.ctx,{type:"line",data:{datasets:[{label:u,data:f,tension:l,backgroundColor:"transparent",borderColor:b,borderWidth:2,pointRadius:1.5,pointBackgroundColor:b,stepped:g,cubicInterpolationMode:r?"monotone":"default",fill:{target:"origin",above:d}}]},options:{interaction:{mode:"index",intersect:!1},tooltips:{mode:"interpolate",intersect:!1},plugins:{tooltip:{callbacks:{label:h=>{let p=h.dataset.label||"";return h.parsed.y!==null&&(p=`B./ ${T(h.parsed.y,2)}`),p}}},title:{display:!0,text:u,color:y,font:{size:12}},subtitle:{display:!0,text:o?`${v}: B/. ${T(j,2)}`:`${v} ${f[f.length-1].x}: B/. ${T(j,2)}`,color:y,font:{size:12,weight:"bold"},padding:{top:10},position:"bottom",align:"start"},legend:{display:!1}},responsive:!0,scales:{x:{border:{color:c},grid:{color:c,tickColor:c},display:!0,stacked:!0,ticks:{color:y,autoSkip:!0,maxRotation:0,minRotation:0}},y:{border:{color:c},grid:{color:c,tickColor:c},ticks:{callback:h=>`B/. ${T(h,2)}`,color:y,stepSize:.25,font:{size:10},autoSkip:!0},stacked:!0,beginAtZero:!0}}}})}destroy(){this.chart.destroy()}static getInstances(){return Object.values(F.instances)}static destroyAll(){this.getInstances().forEach(s=>s.destroy())}}const tt={props:{tarjeta:{type:Object,required:!0}},data(){return{dataset:{gastos:[]},filters:{d1:1,d7:7,d28:28},daysBefore:28,charts:[{name:"gastos",reduce:!0,monotone:!0,title:a("grafica_gastos"),subtitle:a("gasto_total"),color:"danger",condition:t=>t===a("uso")||t===a("puerta_trasera")},{name:"cambio",reduce:!1,monotone:!1,title:a("grafica_saldo"),subtitle:a("saldo_hasta"),stepped:!0,color:"dark",condition:()=>!0},{name:"cargas",reduce:!0,monotone:!0,title:a("grafica_recargas"),subtitle:a("recarga_total"),color:"success",condition:t=>t===a("carga")||t===a("carga_online")}]}},computed:{getDaysBefore(){const t=V().getTime(),s=[];for(let o=this.daysBefore;o>0;o--){const d=new Date(t-G-o*24*60*60*1e3).toISOString().split("T")[0];s.push({x:d,y:0})}return s},get24hours(){const t=[];for(let s=0;s<24;s++)t.push({x:String(s),y:0});return t}},watch:{daysBefore(){R.destroyAll(),this.render()}},mounted(){this.render()},methods:{getData(t){const s=[],o=this.daysBefore>1?this.getDaysBefore:this.get24hours,b=o.length,d=new Date(o[b-1].x).getTime(),u=new Date(o[0].x).getTime();let r={x:"",y:0};if(this.tarjeta.movimientos.forEach(l=>{const g=new Date(Number(l.fecha)-G).toISOString().split("T")[0],v=new Date(g).getTime(),y=this.charts.find(f=>f.name===t).condition(l.movimiento),c=Number(t==="cambio"?l.saldo:l.monto);if(this.daysBefore>1)v>u&&v<=d&&this.charts.find(j=>j.name===t).condition(l.movimiento)&&(t==="cambio"?s.unshift({x:g,y:c}):s.push({x:g,y:c})),v<u&&!r.y&&t==="cambio"&&y&&(r={x:o[0].x,y:c});else if(g===this.getDaysBefore[0].x){if(y){const f=new Date(Number(l.fecha)).getHours();t==="cambio"?s.unshift({x:String(f),y:c}):s.push({x:String(f),y:c})}}else g<this.getDaysBefore[0].x&&!r.y&&t==="cambio"&&y&&(r={x:o[0].x,y:c})}),t==="cambio"){if(s.length>0){r.y&&s.unshift(r);const l=s[0],g=s[s.length-1];return o.map(y=>{const c=this.daysBefore>1?y.x:Number(y.x);if(c<l.x)return{x:c,y:l.y};if(c>g.x)return{x:c,y:g.y};if(c>l.x){const f=s.findLast(j=>(this.daysBefore>1?j.x:Number(j.x))<c);return{x:c,y:f.y}}return{x:c,y:0}}).concat(s)}return o.map(l=>({x:l.x,y:Number(this.tarjeta.saldo)}))}return o.concat(s)},render(){this.charts.forEach((t,s)=>{const o=this.$refs.chart[s].getContext("2d"),b=this.getData(t.name).map(l=>({x:this.daysBefore>1?q(l.x,"chart",x.lang):U(l.x),y:l.y})),d=new R(o,b),u=x.dark?"dark":"light",r=H.colors;d.render({reduce:t.reduce,monotone:t.monotone,title:t.title,subtitle:t.subtitle,stepped:t.stepped,color:r[u][t.color],color_area:r[u][`${t.color}_area`],text_color:r[u].text,tick_color:r[u].tick})})}}},et={class:"text-center py-2"},st={class:"d-flex align-items-center my-3"},at={class:"d-flex justify-content-evenly flex-grow-1 filters"},ot=["onClick"];function it(t,s,o,b,d,u){return m(),_("div",null,[e("h4",et,[e("b",null,i(("t"in t?t.t:n(a))("graficas")),1)]),e("p",null,"*"+i(("t"in t?t.t:n(a))("grafica_nota")),1),e("div",st,[e("span",null,i(("t"in t?t.t:n(a))("filtrar"))+":",1),e("div",at,[(m(!0),_(D,null,I(d.filters,(r,l)=>(m(),_("button",{key:l,class:B(["btn btn-sm rounded-pill text-nowrap",{active:d.daysBefore===r,"btn-outline-dark":!("CONFIG"in t?t.CONFIG:n(x)).dark,"btn-outline-light":("CONFIG"in t?t.CONFIG:n(x)).dark}]),onClick:g=>d.daysBefore=r},i(("t"in t?t.t:n(a))(l)),11,ot))),128))])]),(m(!0),_(D,null,I(d.charts,(r,l)=>(m(),_("div",{key:l,class:"bg-body-tertiary border rounded p-2 mb-2 shadow"},[e("canvas",{ref_for:!0,ref:"chart",class:"my-2 w-100"},null,512)]))),128))])}const nt=A(tt,[["render",it]]),rt=""+globalThis.__publicAssetsURL("images/rapipass_brand.webp"),lt=""+globalThis.__publicAssetsURL("images/metro_metrobus_brand.webp"),dt=""+globalThis.__publicAssetsURL("images/metrobus_brand.webp"),ct={name:"InfoTarjeta",props:{tarjeta:{type:Object,required:!0}},data(){return{size:200,saldoBar:{percent:0,color:""},dialog:"",form:{nombre:""}}},computed:{percent(){return Number(this.tarjeta.saldo)/50*100},color(){const t=Number(this.tarjeta.saldo);return Number(t)<=2?"danger":Number(t)>2&&Number(t)<5?"warning":"success"}},mounted(){this.form.nombre=this.tarjeta.nombre},methods:{async editCard(){const t=this.$refs.edit;if(t.checkValidity()){C("edit-dialog"),this.dialog=a("editando"),L("progress-dialog");const s=this.form.nombre.trim(),{error:o,error_key:b}=w().isGuest?{error:!1}:await M.updateTarjeta({email:w().user.email,token:w().user.token,numero:this.tarjeta.numero,nombre:s}),{changes:d}=await O.updateNombreTarjeta(this.tarjeta.numero,s);!o&&d>0?(await $.showToast(`${a("editada")}: ${this.tarjeta.numero}`),await N(.5),C("progress-dialog"),this.$router.replace("/app/")):(await $.showToast(a(b)),await N(.5),C("progress-dialog")),t.classList.remove("was-validated")}else t.classList.add("was-validated")},async deleteCard(){if(await $.confirm(a("eliminar_tarjeta"),a("eliminar_seguro"))){this.dialog=a("eliminando"),L("progress-dialog");const{error:s,error_key:o}=w().isGuest?{error:!1}:await M.deleteTarjeta({email:w().user.email,token:w().user.token,numero:this.tarjeta.numero}),{changes:b}=await O.deleteTarjeta(this.tarjeta.numero);!s&&b>0?(await $.showToast(`${a("eliminada")}: ${this.tarjeta.numero}`),await N(.5),C("progress-dialog"),this.$router.replace("/app/")):(await $.showToast(a(o)),await N(.5),C("progress-dialog"))}}}},ut={class:"text-center py-2"},mt={class:"bg-body-tertiary border rounded p-2 mb-2 shadow text-center"},ht=["width","height"],_t=["width","height"],bt=["width","height"],ft={class:"bg-body-tertiary border rounded p-2 mb-2 shadow"},pt={class:"text-primary-emphasis m-0"},gt={class:"m-2"},yt={class:"bg-body-tertiary border rounded p-2 mb-2 shadow"},vt={class:"text-primary-emphasis m-0"},jt={class:"p-2"},wt={class:"row"},kt={class:"col-6"},Ct={class:"m-0"},$t={class:"col-6"},Bt={class:"m-0"},Tt={class:"col-6"},Nt={class:"m-0"},xt={class:"col-6"},Dt={class:"m-0"},It={class:"bg-body-tertiary border rounded p-2 mb-2 shadow"},Ot={class:"text-primary-emphasis m-0"},St={class:"ms-2"},zt={class:"d-flex justify-content-between"},At={class:"small"},Ft={class:"small"},Gt=["aria-label","aria-valuenow"],Lt={class:"d-flex"},Mt={class:"flex-fill"},Rt={class:"d-grid"},qt={class:"btn btn-primary btn-block me-2",role:"button","data-bs-toggle":"modal","data-bs-target":"#edit-dialog"},Et=e("i",{class:"fas fa-sync-alt"},null,-1),Pt={class:"ms-2"},Vt={class:"flex-fill"},Ut={class:"d-grid"},Ht=e("i",{class:"fas fa-sync-alt"},null,-1),Jt={class:"ms-2"},Kt={id:"edit-dialog",class:"modal fade",tabindex:"-1","aria-labelledby":"edit-dialog-label","aria-hidden":"true","data-bs-backdrop":"static"},Wt={class:"modal-dialog modal-dialog-centered"},Zt={class:"modal-content"},Qt={class:"modal-header"},Xt={id:"edit-dialog-label",class:"modal-title fs-5 text-primary-emphasis"},Yt={class:"modal-body text-center"},te={class:"mb-3 position-relative form-floating"},ee=["placeholder"],se={class:"invalid-tooltip"},ae={class:"mb-3 position-relative form-floating"},oe=["value","placeholder"],ie={disabled:""},ne={class:"d-flex justify-content-end"},re={class:"btn btn-danger me-2",type:"button","data-bs-dismiss":"modal"},le={class:"btn btn-primary",type:"submit",role:"button"};function de(t,s,o,b,d,u){const r=P;return m(),_("div",null,[e("h4",ut,[e("b",null,i(o.tarjeta.nombre),1)]),e("div",mt,[o.tarjeta.tipo===("t"in t?t.t:n(a))("tarjeta_rapipass")?(m(),_("img",{key:0,class:"img-fluid",src:rt,width:d.size,height:d.size},null,8,ht)):o.tarjeta.tipo===("t"in t?t.t:n(a))("tarjeta_normal")?(m(),_("img",{key:1,class:"img-fluid",src:lt,width:d.size,height:d.size},null,8,_t)):(m(),_("img",{key:2,src:dt,class:"img-fluid",width:d.size,height:d.size},null,8,bt)),e("h3",null,[e("b",null,i(o.tarjeta.numero),1)])]),e("div",ft,[e("h4",pt,[e("b",null,i(("t"in t?t.t:n(a))("saldo")),1)]),e("div",gt,[e("h3",null,[e("b",null,"B/. "+i(o.tarjeta.saldo),1)])])]),e("div",yt,[e("h4",vt,[e("b",null,i(("t"in t?t.t:n(a))("info_tarjeta")),1)]),e("div",jt,[e("div",wt,[e("div",kt,[e("p",Ct,[e("b",null,i(("t"in t?t.t:n(a))("numero_tarjeta")),1)]),e("p",null,i(o.tarjeta.numero),1)]),e("div",$t,[e("p",Bt,[e("b",null,i(("t"in t?t.t:n(a))("estado")),1)]),e("p",null,i(o.tarjeta.estado),1)]),e("div",Tt,[e("p",Nt,[e("b",null,i(("t"in t?t.t:n(a))("fecha")),1)]),e("p",null,i(o.tarjeta.fecha),1)]),e("div",xt,[e("p",Dt,[e("b",null,i(("t"in t?t.t:n(a))("tipo_tarjeta")),1)]),e("p",null,i(o.tarjeta.tipo),1)])])])]),e("div",It,[e("h4",Ot,[e("b",null,i(("t"in t?t.t:n(a))("balance")),1)]),e("div",St,[e("div",zt,[e("h4",At,[e("b",null,"Actual: B/. "+i(o.tarjeta.saldo),1)]),e("h4",Ft,[e("b",null,"B/. "+i(Number(o.tarjeta.saldo)>50?o.tarjeta.saldo:"50.00"),1)])]),e("div",{class:"progress",role:"progressbar","aria-label":("t"in t?t.t:n(a))("balance"),"aria-valuenow":u.percent,"aria-valuemin":"0","aria-valuemax":"100"},[e("div",{class:B(["progress-bar",`bg-${u.color}`]),style:J(`width: ${u.percent}%`)},null,6)],8,Gt)])]),e("div",Lt,[e("div",Mt,[e("div",Rt,[e("button",qt,[Et,e("span",Pt,i(("t"in t?t.t:n(a))("editar")),1)])])]),e("div",Vt,[e("div",Ut,[e("button",{class:"btn btn-danger btn-block ms-1",onClick:s[0]||(s[0]=l=>u.deleteCard())},[Ht,e("span",Jt,i(("t"in t?t.t:n(a))("eliminar")),1)])])])]),e("div",Kt,[e("div",Wt,[e("div",Zt,[e("div",Qt,[e("h1",Xt,i(("t"in t?t.t:n(a))("editar_tarjeta")),1)]),e("div",Yt,[e("form",{ref:"edit",novalidate:"",onSubmit:s[2]||(s[2]=K(l=>u.editCard(),["prevent"]))},[e("div",te,[W(e("input",{"onUpdate:modelValue":s[1]||(s[1]=l=>d.form.nombre=l),class:"form-control",type:"text",placeholder:("t"in t?t.t:n(a))("nombre"),required:""},null,8,ee),[[Z,d.form.nombre]]),e("label",null,i(("t"in t?t.t:n(a))("nombre")),1),e("div",se,i(("t"in t?t.t:n(a))("obligatorio")),1)]),e("div",ae,[e("input",{class:"form-control",type:"number",value:o.tarjeta.numero,placeholder:("t"in t?t.t:n(a))("numero_tarjeta"),disabled:""},null,8,oe),e("label",ie,i(("t"in t?t.t:n(a))("numero_tarjeta")),1)]),e("div",ne,[e("button",re,i(("t"in t?t.t:n(a))("cancel")),1),e("button",le,i(("t"in t?t.t:n(a))("editar")),1)])],544)])])])]),E(r,{message:d.dialog},null,8,["message"])])}const ce=A(ct,[["render",de]]),ue={name:"MovimientosTarjeta",props:{tarjeta:{type:Object,required:!0}}},me={class:"text-center py-2"},he={class:"m-0"},_e={class:"table-responsive"},be={key:0,class:"table table-hover shadow small"},fe={class:"bg-primary"},pe={class:"text-white small"},ge={scope:"col"},ye={scope:"col"},ve=e("th",{class:"pe-0"},null,-1),je={class:"ps-0",scope:"col"},we={scope:"col"},ke={class:"bg-body-tertiary"},Ce=["title"],$e={class:"text-nowrap"},Be={key:1,class:"text-center my-4"};function Te(t,s,o,b,d,u){return m(),_("div",null,[e("h4",me,[e("b",null,i(("t"in t?t.t:n(a))("saldos")),1)]),e("p",he,i(("t"in t?t.t:n(a))("mov_4_semanas")),1),e("div",_e,[o.tarjeta.movimientos.length>0?(m(),_("table",be,[e("thead",fe,[e("tr",pe,[e("th",ge,i(("t"in t?t.t:n(a))("tipo")),1),e("th",ye,i(("t"in t?t.t:n(a))("fecha_mov")),1),ve,e("th",je,i(("t"in t?t.t:n(a))("monto")),1),e("th",we,i(("t"in t?t.t:n(a))("saldo")),1)])]),e("tbody",ke,[(m(!0),_(D,null,I(o.tarjeta.movimientos,r=>(m(),_("tr",{key:r.id,class:"small",role:"button"},[e("td",null,i(r.movimiento),1),e("td",{title:r.fecha,class:"text-nowrap"},i(("formatFecha"in t?t.formatFecha:n(q))(Number(r.fecha))),9,Ce),e("td",{class:B(["pe-0 text-end",`text-${r.color}`])},i(r.sign),3),e("td",{class:B(["ps-0 text-nowrap ps-0",`text-${r.color}`])},"B/. "+i(r.monto),3),e("td",$e,"B/. "+i(r.saldo),1)]))),128))])])):(m(),_("p",Be,[e("i",null,i(("t"in t?t.t:n(a))("mov_notfound"))+".",1)]))])])}const Ne=A(ue,[["render",Te]]);const xe={id:"tabs",class:"nav nav-pills",role:"tablist"},De={class:"d-grid gap-2"},Ie=["onClick"],Oe={class:"pt-5"},Se={data(){return{tarjeta:{},tabs:{informacion:!1,movimientos:!1,graficas:!1}}},async mounted(){const t=this.$route.params.tarjeta;this.tarjeta=await O.getTarjeta(t),this.tarjeta.movimientos=await O.getMovimientos(t),this.tabs.informacion=!0},methods:{tabClick(t){this.tabs={informacion:!1,movimientos:!1,graficas:!1},this.tabs[t]=!0}}},Fe=Object.assign(Se,{__name:"[tarjeta]",setup(t){return(s,o)=>{const b=ce,d=Ne,u=nt;return m(),_("section",null,[e("ul",xe,[(m(!0),_(D,null,I(s.tabs,(r,l)=>(m(),_("li",{key:l,class:"nav-item flex-fill",role:"presentation"},[e("div",De,[e("a",{class:B(["nav-link rounded-0 text-uppercase text-center",{active:r}]),role:"button",onClick:g=>s.tabClick(l)},i(("t"in s?s.t:n(a))(l)),11,Ie)])]))),128))]),e("div",Oe,[E(X,{name:"tab",mode:"out-in"},{default:Q(()=>[s.tabs.informacion?(m(),z(b,{key:0,tarjeta:s.tarjeta},null,8,["tarjeta"])):s.tabs.movimientos?(m(),z(d,{key:1,tarjeta:s.tarjeta},null,8,["tarjeta"])):s.tabs.graficas?(m(),z(u,{key:2,tarjeta:s.tarjeta},null,8,["tarjeta"])):Y("",!0)]),_:1})])])}}});export{Fe as default};
