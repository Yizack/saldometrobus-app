import{_ as E}from"./DhEdULM1.js";import{_ as N}from"./B9B-OaP-.js";import{_ as O}from"./Dgu_aBXO.js";import{c as T,o as b,a as t,t as o,e as s,f as e,J as G,A as U,K as k,L as q,M as H,D as r,l as w,s as $,k as j,C as u,m as C,b as v,p as J,w as I,N as K,i as R,j as L,v as B,F as Z,r as Q,H as W,T as X,g as Y,O as x}from"./Czg0Q_ZR.js";import{_ as tt}from"./DlAUqK2U.js";import{u as at}from"./C8RZ1v4a.js";import"./B7g_wYYe.js";const et={},st={id:"limit-dialog",class:"modal fade",tabindex:"-1","aria-labelledby":"progress-dialog-label","aria-hidden":"true","data-bs-backdrop":"static"},ot={class:"modal-dialog modal-dialog-centered"},it={class:"modal-content"},nt={class:"modal-header"},lt={id:"progress-dialog-label",class:"modal-title text-primary-emphasis"},rt={class:"modal-body"},dt={class:"m-0"},ct={class:"modal-footer"},mt={class:"btn btn-primary w-100",type:"button","data-bs-dismiss":"modal"};function ut(_,m){return b(),T("div",st,[t("div",ot,[t("div",it,[t("div",nt,[t("h5",lt,[t("strong",null,o(("t"in _?_.t:s(e))("limit_tittle")),1)])]),t("div",rt,[t("p",dt,o(("t"in _?_.t:s(e))("limit_message")),1)]),t("div",ct,[t("button",mt,o(("t"in _?_.t:s(e))("entendido")),1)])])])])}const _t=Object.assign(tt(et,[["render",ut]]),{__name:"LimitDialog"}),ht={class:"d-flex"},pt={class:"flex-grow-1"},gt={class:"info mx-2 small"},ft={class:"m-0"},bt={key:0},wt={class:"m-0"},vt={class:"m-0"},Tt={class:"m-0"},jt={class:"text-nowrap m-0"},yt={key:1},kt={class:"actions d-flex flex-column"},$t={class:"image mb-2"},Ct=["src","width","height"],Dt={class:"d-grid"},It=["onClick"],Mt={key:0,class:"text-center mt-3"},At={class:"small m-0"},Lt={class:"position-fixed bottom-0 end-0 m-3"},Bt={class:"btn btn-primary rounded-circle p-1 shadow",role:"button","data-bs-toggle":"modal","data-bs-target":"#add-dialog"},Pt={id:"add-dialog",class:"modal fade",tabindex:"-1","aria-labelledby":"add-dialog-label","aria-hidden":"true","data-bs-backdrop":"static"},zt={class:"modal-dialog modal-dialog-centered"},Vt={class:"modal-content"},Ft={class:"modal-header"},St={id:"add-dialog-label",class:"modal-title fs-5 text-primary-emphasis"},Et={class:"modal-body text-center"},Nt={class:"mb-3 position-relative form-floating"},Ot=["placeholder"],Gt={class:"invalid-tooltip"},Ut={class:"mb-3 position-relative form-floating"},qt=["placeholder"],Ht={class:"invalid-tooltip"},Jt={class:"d-flex justify-content-end"},Kt={class:"btn btn-danger me-2",type:"button","data-bs-dismiss":"modal"},Rt={class:"btn btn-primary",type:"submit",role:"button"},aa=G({__name:"index",setup(_){const m=U(),h=k([]),M=k(0),P=k(4),y=k(""),p=at({numero:"",nombre:""}),A={width:100,height:63},D=q(()=>M.value>P.value),z=a=>{if(!a.saldo)return u.showToast(e("actualiza_tarjeta"),"long");x(`/app/${a.numero}`)},V=async a=>{y.value=e("adding_tarjeta");const l=a.currentTarget;if(!l.checkValidity())return l.classList.add("was-validated");C("add-dialog"),$("progress-dialog");const{tarjeta:i,error:g,error_key:c}=await j.getTarjetaAPI(p.value.numero);if(i&&!g){if(i.nombre=p.value.nombre,i.fecha_added=new Date().toISOString().replace("T"," ").replace("Z",""),await r.tarjetaExists(i.numero))await u.showToast(`${e("existe_tarjeta")}: ${i.numero}`);else{const{error:n,error_key:d}=m.isGuest?{error:!1}:await j.addTarjeta({nombre:i.nombre,numero:i.numero,email:m.user.email,token:m.user.token});await r.insertTarjeta(i)>0&&!n?(await r.insertMovimientos(i),await u.showToast(`${e("tarjeta_added")}: ${i.numero}`)):await u.showToast(e(d)),h.value=await r.getTarjetas()}p.reset()}else await u.showToast(e(c||"error"),"long");await w(.5),C("progress-dialog"),l.classList.remove("was-validated")},F=async(a,l)=>{a.stopPropagation(),y.value=e("actualizando_tarjeta"),$("progress-dialog");const{tarjeta:i,error:g,error_key:c}=await j.getTarjetaAPI(l,!0);i&&!g?await r.updateTarjeta(i)>0&&(await r.deleteMovimientos(l),await r.insertMovimientos(i),await u.showToast(`${e("tarjeta_actualizada")}: ${i.numero}`),h.value=await r.getTarjetas()):await u.showToast(e(c||"error"),"long"),await w(.5),C("progress-dialog")};return H(async()=>{if(!m.exists||(h.value=await r.getTarjetas(),h.value.length||m.user.updated||m.isGuest))return;y.value=e("adding_tarjetas"),await w(.5),$("progress-dialog");const{email:a,token:l}=m.user,{error:i,error_key:g,tarjetas:c}=await j.getTarjetas({email:a,token:l})||[];let f=[];i&&await u.showToast(e(g),"long"),c&&(M.value=c.length,D.value?f=c||[]:f=await j.getDetallesTarjetas(c)||[]);for(const d of f)await r.insertTarjeta(d)>0&&!D.value&&await r.insertMovimientos(d);const n=await r.getTarjetas();for(const d of n)h.value.push(d),d.saldo&&await u.showToast(`${e("tarjeta_added")}: ${d.numero}`),await w(.5);await m.setUpdated(),await w(.5),C("progress-dialog"),D.value&&(await w(.5),$("limit-dialog"))}),(a,l)=>{const i=E,g=N,c=O,f=_t;return b(),T("section",null,[v(K,{name:"tab"},{default:I(()=>[(b(!0),T(Z,null,Q(s(h),n=>(b(),W(g,{key:n.numero,title:n.nombre,p2:"",role:"button",onClick:d=>z(n)},{default:I(()=>[t("div",ht,[t("div",pt,[t("div",gt,[t("p",ft,[t("b",null,o(("t"in a?a.t:s(e))("numero"))+": "+o(n.numero),1)]),v(X,{name:"fade",mode:"out-in"},{default:I(()=>[n.saldo?(b(),T("div",bt,[t("p",wt,o(("t"in a?a.t:s(e))("estado"))+": "+o(n.estado),1),t("p",vt,o(("t"in a?a.t:s(e))("tipo"))+": "+o(n.tipo),1),t("p",Tt,o(("t"in a?a.t:s(e))("fecha"))+": "+o(n.fecha),1),t("h3",jt,[t("b",null,o(("t"in a?a.t:s(e))("saldo"))+": B/. "+o(n.saldo),1)])])):(b(),T("div",yt,l[2]||(l[2]=[t("p",{class:"placeholder-glow m-0"},[t("span",{class:"placeholder col-6"})],-1),t("p",{class:"placeholder-glow m-0"},[t("span",{class:"placeholder col-5"})],-1),t("p",{class:"placeholder-glow m-0"},[t("span",{class:"placeholder col-7"})],-1),t("h3",{class:"placeholder-glow"},[t("span",{class:"placeholder col-6"})],-1)])))]),_:2},1024)])]),t("div",kt,[t("div",$t,[t("img",{class:"img-fluid rounded shadow-sm",src:`/images/${("getCardImage"in a?a.getCardImage:s(Y))(n.tipo)}`,width:A.width,height:A.height},null,8,Ct)]),t("div",Dt,[t("button",{class:"btn btn-secondary btn-sm py-2",role:"button",onClick:d=>F(d,n.numero)},[v(i,{name:"refresh",size:"md"})],8,It)])])])]),_:2},1032,["title","onClick"]))),128))]),_:1}),s(h).length?(b(),T("div",Mt,[t("p",At,[t("small",null,o(("t"in a?a.t:s(e))("tarjetas_note")),1)])])):J("",!0),t("div",Lt,[t("button",Bt,[v(i,{name:"plus",size:"lg"})])]),t("div",Pt,[t("div",zt,[t("div",Vt,[t("div",Ft,[t("h1",St,[t("strong",null,o(("t"in a?a.t:s(e))("add_tarjeta")),1)])]),t("div",Et,[t("form",{novalidate:"",onSubmit:R(V,["prevent"])},[t("div",Nt,[L(t("input",{"onUpdate:modelValue":l[0]||(l[0]=n=>s(p).nombre=n),class:"form-control",type:"text",placeholder:("t"in a?a.t:s(e))("nombre"),required:""},null,8,Ot),[[B,s(p).nombre,void 0,{trim:!0}]]),t("label",null,o(("t"in a?a.t:s(e))("nombre")),1),t("div",Gt,o(("t"in a?a.t:s(e))("obligatorio")),1)]),t("div",Ut,[L(t("input",{"onUpdate:modelValue":l[1]||(l[1]=n=>s(p).numero=n),class:"form-control",type:"number",pattern:"[0-9]",placeholder:("t"in a?a.t:s(e))("numero_tarjeta"),required:""},null,8,qt),[[B,s(p).numero]]),t("label",null,o(("t"in a?a.t:s(e))("numero_tarjeta")),1),t("div",Ht,o(("t"in a?a.t:s(e))("error_tarjeta")),1)]),t("div",Jt,[t("button",Kt,o(("t"in a?a.t:s(e))("cancel")),1),t("button",Rt,o(("t"in a?a.t:s(e))("add")),1)])],32)])])])]),v(c,{message:s(y)},null,8,["message"]),v(f)])}}});export{aa as default};
