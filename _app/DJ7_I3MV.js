import{_ as K}from"./DBQoA6qK.js";import{_ as L}from"./QiGDHC6T.js";import{K as O,A as $,L as w,M as z,N as B,O as E,D,c,a as o,p as v,b as A,t as d,e as s,j as f,v as g,h as k,w as H,T as J,F as Q,r as W,i as X,k as V,C as p,f as t,o as m,H as G,s as U,l as N,m as P,R as Y}from"./BxewTVV3.js";import"./Dlw2lFTK.js";const Z={class:"bg-body-tertiary border rounded p-2 mb-2 shadow"},x={class:"text-primary-emphasis m-0"},ee={class:"input-group p-2"},se={class:"bg-body-tertiary border rounded p-2 mb-2 shadow"},oe={class:"text-primary-emphasis m-0"},te={class:"m-2"},ae=["value"],re={class:"bg-body-tertiary border rounded p-2 mb-2 shadow"},ne={class:"text-primary-emphasis m-0"},le={class:"m-2"},ie={class:"ms-2 my-0"},de={key:1,class:"m-0"},ue={key:0,class:"bg-body-tertiary border rounded p-2 mb-2 shadow"},me={class:"text-primary-emphasis m-0"},ce={class:"m-2"},pe={class:"mb-3 position-relative form-floating"},_e=["placeholder"],be={class:"invalid-tooltip"},we={class:"mb-3 form-floating"},ve=["placeholder"],he={class:"mb-3 form-floating"},ye=["placeholder"],fe={class:"d-grid"},ge={class:"btn btn-primary",type:"submit",role:"button"},ke={key:1,class:"bg-body-tertiary border rounded p-2 shadow"},Te={class:"text-primary-emphasis m-0"},Ce={class:"m-2"},Ae=["value"],Ve={key:2,class:"d-grid"},Ne={key:3,class:"text-center mt-3"},Pe={class:"small m-0"},Ue=O({__name:"perfil",setup(je){const r=$(),T=w(""),b=w({nombre:!1}),i=w({nombre:r.user.nombre,email:r.user.email,token:r.user.token,tarjetas:[]}),n=z({current_password:"",new_password:"",password_check:"",error:!1}),C=B(()=>n.value.new_password.length>=3&&n.value.current_password!==n.value.new_password&&n.value.current_password.length>0),j=B(()=>C.value&&n.value.new_password===n.value.password_check),_=w(),S=async()=>{var e,a,u,h,l;if(b.value.nombre=!b.value.nombre,i.value.nombre=i.value.nombre.trim(),b.value.nombre){const y=i.value.nombre.length;(e=_.value)==null||e.setSelectionRange(y,y),(a=_.value)==null||a.focus(),(u=_.value)==null||u.removeAttribute("readonly")}else{if(i.value.nombre!==r.user.nombre){const{error:y,error_key:R}=await V.updateName({nombre:i.value.nombre,email:r.user.email,token:r.user.token||""});y?(i.value.nombre=r.user.nombre,await p.showToast(t(R))):(r.updateName(i.value.nombre),await p.showToast(t("name_updated")))}(h=_.value)==null||h.setAttribute("readonly","true"),(l=_.value)==null||l.blur()}},M=w(),q=async()=>{var e;if(C.value&&j.value){T.value=t("updating_pass"),U("progress-dialog");const{error:a,error_key:u}=await V.userPassUpdate({current_password:n.value.current_password,new_password:n.value.new_password,email:r.user.email,token:r.user.token});a?(u==="pass_error"&&(n.value.error=!0,(e=M.value)==null||e.focus()),await p.showToast(t(u),"long")):(await p.showToast(t("pass_updated"),"long"),n.reset())}await N(.5),P("progress-dialog")},F=e=>{e.currentTarget.select(),p.writeToClipboard(i.value.token)},I=async()=>{if(await p.confirm(t("delete_account"),t("delete_account_sure"))){T.value=t("deleting_account"),U("progress-dialog");const{error:a,error_key:u}=await V.deleteAccount({email:r.user.email,token:r.user.token});a?(await p.showToast(t(u)),await N(.5),P("progress-dialog")):(await D.deleteAll(),await r.logout(),await p.showToast(t("account_deleted")),await N(.5),P("progress-dialog"),Y("/",{replace:!0}))}};return E(async()=>{i.value.tarjetas=await D.getTarjetas()}),(e,a)=>{const u=K,h=L;return m(),c("section",null,[o("div",Z,[o("h4",x,[o("b",null,d(("t"in e?e.t:s(t))("nombre")),1)]),o("div",ee,[f(o("input",{ref_key:"nombre",ref:_,"onUpdate:modelValue":a[0]||(a[0]=l=>s(i).nombre=l),class:"form-control py-2",type:"text",readonly:""},null,512),[[g,s(i).nombre]]),s(r).isGuest?v("",!0):(m(),c("button",{key:0,class:k(["btn btn-sm",s(b).nombre?"btn-success":"btn-primary"]),style:{width:"3rem"},onClick:a[1]||(a[1]=l=>S())},[A(J,{name:"tab",mode:"out-in"},{default:H(()=>[s(b).nombre?(m(),G(u,{key:0,name:"check"})):(m(),G(u,{key:1,name:"edit"}))]),_:1})],2))])]),o("div",se,[o("h4",oe,[o("b",null,d(("t"in e?e.t:s(t))("correo")),1)]),o("div",te,[o("input",{value:s(i).email,class:"form-control py-2",type:"text",readonly:""},null,8,ae)])]),o("div",re,[o("h4",ne,[o("b",null,d(("t"in e?e.t:s(t))("tarjetas_vinculadas")),1)]),o("div",le,[s(i).tarjetas.length?(m(!0),c(Q,{key:0},W(s(i).tarjetas,l=>(m(),c("div",{key:l.numero,class:"d-flex align-items-center"},[A(u,{name:"card"}),o("p",ie,d(l.numero)+" ("+d(l.nombre)+")",1)]))),128)):(m(),c("p",de,d(("t"in e?e.t:s(t))("no_tarjetas")),1))])]),s(r).isGuest?v("",!0):(m(),c("div",ue,[o("h4",me,[o("b",null,d(("t"in e?e.t:s(t))("password")),1)]),o("div",ce,[o("form",{novalidate:"",onSubmit:X(q,["prevent"])},[o("div",pe,[f(o("input",{ref_key:"current",ref:M,"onUpdate:modelValue":a[2]||(a[2]=l=>s(n).current_password=l),class:k(["form-control",{"is-invalid":s(n).error}]),type:"password",autocomplete:"password",placeholder:("t"in e?e.t:s(t))("current_pass"),required:"",onKeyup:a[3]||(a[3]=l=>s(n).error=!1)},null,42,_e),[[g,s(n).current_password]]),o("label",null,d(("t"in e?e.t:s(t))("current_pass")),1),o("div",be,d(("t"in e?e.t:s(t))("pass_error")),1)]),o("div",we,[f(o("input",{"onUpdate:modelValue":a[4]||(a[4]=l=>s(n).new_password=l),class:k(["form-control",{"is-valid":s(C)}]),type:"password",autocomplete:"new-password",placeholder:("t"in e?e.t:s(t))("new_pass"),required:""},null,10,ve),[[g,s(n).new_password]]),o("label",null,d(("t"in e?e.t:s(t))("new_pass")),1)]),o("div",he,[f(o("input",{"onUpdate:modelValue":a[5]||(a[5]=l=>s(n).password_check=l),class:k(["form-control",{"is-valid":s(j)}]),type:"password",autocomplete:"off",placeholder:("t"in e?e.t:s(t))("password_check"),required:""},null,10,ye),[[g,s(n).password_check]]),o("label",null,d(("t"in e?e.t:s(t))("password_check")),1)]),o("div",fe,[o("button",ge,d(("t"in e?e.t:s(t))("change_pass")),1)])],32)])])),s(r).isGuest?v("",!0):(m(),c("div",ke,[o("h4",Te,[o("b",null,d(("t"in e?e.t:s(t))("account_id")),1)]),o("div",Ce,[o("input",{value:s(i).token,class:"form-control py-2",type:"text",readonly:"",onClick:a[6]||(a[6]=l=>F(l))},null,8,Ae)])])),s(r).isGuest?v("",!0):(m(),c("div",Ve,[o("button",{class:"btn btn-danger mt-2",onClick:I},d(("t"in e?e.t:s(t))("delete_account")),1)])),s(r).isGuest?(m(),c("div",Ne,[o("p",Pe,[o("small",null,d(("t"in e?e.t:s(t))("nota")),1)])])):v("",!0),A(h,{message:s(T)},null,8,["message"])])}}});export{Ue as default};
